/*! For license information please see did-jwt.js.LICENSE.txt */
var e={820:e=>{e.exports=function(e){if(e.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var n=0;n<e.length;n++){var o=e.charAt(n),i=o.charCodeAt(0);if(255!==t[i])throw new TypeError(o+" is ambiguous");t[i]=n}var s=e.length,c=e.charAt(0),a=Math.log(s)/Math.log(256),f=Math.log(256)/Math.log(s);function u(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var r=0;if(" "!==e[r]){for(var n=0,o=0;e[r]===c;)n++,r++;for(var i=(e.length-r)*a+1>>>0,f=new Uint8Array(i);e[r];){var u=t[e.charCodeAt(r)];if(255===u)return;for(var h=0,d=i-1;(0!==u||h<o)&&-1!==d;d--,h++)u+=s*f[d]>>>0,f[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");o=h,r++}if(" "!==e[r]){for(var l=i-o;l!==i&&0===f[l];)l++;for(var p=new Uint8Array(n+(i-l)),y=n;l!==i;)p[y++]=f[l++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,o=0,i=t.length;o!==i&&0===t[o];)o++,r++;for(var a=(i-o)*f+1>>>0,u=new Uint8Array(a);o!==i;){for(var h=t[o],d=0,l=a-1;(0!==h||d<n)&&-1!==l;l--,d++)h+=256*u[l]>>>0,u[l]=h%s>>>0,h=h/s>>>0;if(0!==h)throw new Error("Non-zero carry");n=d,o++}for(var p=a-n;p!==a&&0===u[p];)p++;for(var y=c.repeat(r);p<a;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:u,decode:function(e){var t=u(e);if(t)return t;throw new Error("Non-base"+s+" character")}}}},456:e=>{e.exports=function e(t){if("number"==typeof t&&isNaN(t))throw new Error("NaN is not allowed");if("number"==typeof t&&!isFinite(t))throw new Error("Infinity is not allowed");return null===t||"object"!=typeof t?JSON.stringify(t):t.toJSON instanceof Function?e(t.toJSON()):Array.isArray(t)?`[${t.reduce(((t,r,n)=>`${t}${0===n?"":","}${e(void 0===r||"symbol"==typeof r?null:r)}`),"")}]`:`{${Object.keys(t).sort().reduce(((r,n)=>void 0===t[n]||"symbol"==typeof t[n]?r:`${r}${0===r.length?"":","}${e(n)}:${e(t[n])}`),"")}}`}},556:(e,t,r)=>{const{encodeText:n}=r(413);e.exports=class{constructor(e,t,r,o){this.name=e,this.code=t,this.codeBuf=n(this.code),this.alphabet=o,this.codec=r(o)}encode(e){return this.codec.encode(e)}decode(e){for(const t of e)if(this.alphabet&&this.alphabet.indexOf(t)<0)throw new Error(`invalid character '${t}' in '${e}'`);return this.codec.decode(e)}}},77:(e,t,r)=>{const n=r(820),o=r(556),{rfc4648:i}=r(727),{decodeText:s,encodeText:c}=r(413),a=[["identity","\0",()=>({encode:s,decode:c}),""],["base2","0",i(1),"01"],["base8","7",i(3),"01234567"],["base10","9",n,"0123456789"],["base16","f",i(4),"0123456789abcdef"],["base16upper","F",i(4),"0123456789ABCDEF"],["base32hex","v",i(5),"0123456789abcdefghijklmnopqrstuv"],["base32hexupper","V",i(5),"0123456789ABCDEFGHIJKLMNOPQRSTUV"],["base32hexpad","t",i(5),"0123456789abcdefghijklmnopqrstuv="],["base32hexpadupper","T",i(5),"0123456789ABCDEFGHIJKLMNOPQRSTUV="],["base32","b",i(5),"abcdefghijklmnopqrstuvwxyz234567"],["base32upper","B",i(5),"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"],["base32pad","c",i(5),"abcdefghijklmnopqrstuvwxyz234567="],["base32padupper","C",i(5),"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567="],["base32z","h",i(5),"ybndrfg8ejkmcpqxot1uwisza345h769"],["base36","k",n,"0123456789abcdefghijklmnopqrstuvwxyz"],["base36upper","K",n,"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"],["base58btc","z",n,"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"],["base58flickr","Z",n,"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"],["base64","m",i(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"],["base64pad","M",i(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="],["base64url","u",i(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"],["base64urlpad","U",i(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_="]],f=a.reduce(((e,t)=>(e[t[0]]=new o(t[0],t[1],t[2],t[3]),e)),{}),u=a.reduce(((e,t)=>(e[t[1]]=f[t[0]],e)),{});e.exports={names:f,codes:u}},957:(e,t,r)=>{const n=r(77),{encodeText:o,decodeText:i,concat:s}=r(413);function c(e){if(Object.prototype.hasOwnProperty.call(n.names,e))return n.names[e];if(Object.prototype.hasOwnProperty.call(n.codes,e))return n.codes[e];throw new Error(`Unsupported encoding: ${e}`)}(t=e.exports=function(e,t){if(!t)throw new Error("requires an encoded Uint8Array");const{name:r,codeBuf:n}=c(e);return function(e,t){c(e).decode(i(t))}(r,t),s([n,t],n.length+t.length)}).encode=function(e,t){const r=c(e),n=o(r.encode(t));return s([r.codeBuf,n],r.codeBuf.length+n.length)},t.decode=function(e){e instanceof Uint8Array&&(e=i(e));const t=e[0];return["f","F","v","V","t","T","b","B","c","C","h","k","K"].includes(t)&&(e=e.toLowerCase()),c(e[0]).decode(e.substring(1))},t.isEncoded=function(e){if(e instanceof Uint8Array&&(e=i(e)),"[object String]"!==Object.prototype.toString.call(e))return!1;try{return c(e[0]).name}catch(e){return!1}},t.encoding=c,t.encodingFromData=function(e){return e instanceof Uint8Array&&(e=i(e)),c(e[0])};const a=Object.freeze(n.names),f=Object.freeze(n.codes);t.names=a,t.codes=f},727:e=>{e.exports={rfc4648:e=>t=>({encode:r=>((e,t,r)=>{const n="="===t[t.length-1],o=(1<<r)-1;let i="",s=0,c=0;for(let n=0;n<e.length;++n)for(c=c<<8|e[n],s+=8;s>r;)s-=r,i+=t[o&c>>s];if(s&&(i+=t[o&c<<r-s]),n)for(;i.length*r&7;)i+="=";return i})(r,t,e),decode:r=>((e,t,r)=>{const n={};for(let e=0;e<t.length;++e)n[t[e]]=e;let o=e.length;for(;"="===e[o-1];)--o;const i=new Uint8Array(o*r/8|0);let s=0,c=0,a=0;for(let t=0;t<o;++t){const o=n[e[t]];if(void 0===o)throw new SyntaxError("Invalid character "+e[t]);c=c<<r|o,s+=r,s>=8&&(s-=8,i[a++]=255&c>>s)}if(s>=r||255&c<<8-s)throw new SyntaxError("Unexpected end of data");return i})(r,t,e)})}},413:e=>{const t=new TextDecoder,r=new TextEncoder;e.exports={decodeText:e=>t.decode(e),encodeText:e=>r.encode(e),concat:function(e,t){const r=new Uint8Array(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return r}}}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{r.d(n,{_D:()=>gi,qT:()=>vi,vo:()=>mi,_J:()=>bi,Fh:()=>Oi,Qu:()=>Ei,R8:()=>wi,Ks:()=>Ho,K9:()=>jo,NX:()=>Wo,RV:()=>Co,ci:()=>Qo,z0:()=>Mo,kr:()=>ws,Gp:()=>ys,Qf:()=>yi,_6:()=>Bs,ax:()=>xs,P9:()=>As,aD:()=>vs,I7:()=>ms,zO:()=>us,pk:()=>zi,XX:()=>qi,qK:()=>Ji,yv:()=>bs,xK:()=>gs,fq:()=>ps,xp:()=>ts,jB:()=>fs,cJ:()=>Fo,bK:()=>ai,nr:()=>Xo,_v:()=>Go,AX:()=>Es,Md:()=>qo,Mq:()=>di,ZW:()=>ns,PZ:()=>Vi,Y:()=>Ts,Qv:()=>ks,$1:()=>Ls,_I:()=>Us,UR:()=>ls,C2:()=>ds});var e={};r.r(e),r.d(e,{identity:()=>T});var t={};r.r(t),r.d(t,{base2:()=>O});var o={};r.r(o),r.d(o,{base8:()=>L});var i={};r.r(i),r.d(i,{base10:()=>R});var s={};r.r(s),r.d(s,{base16:()=>$,base16upper:()=>K});var c={};r.r(c),r.d(c,{base32:()=>N,base32hex:()=>j,base32hexpad:()=>W,base32hexpadupper:()=>V,base32hexupper:()=>H,base32pad:()=>_,base32padupper:()=>C,base32upper:()=>D,base32z:()=>J});var a={};r.r(a),r.d(a,{base36:()=>q,base36upper:()=>z});var f={};r.r(f),r.d(f,{base58btc:()=>F,base58flickr:()=>M});var u={};r.r(u),r.d(u,{base64:()=>G,base64pad:()=>X,base64url:()=>Z,base64urlpad:()=>Y});var h={};r.r(h),r.d(h,{base256emoji:()=>re});var d={};r.r(d),r.d(d,{sha256:()=>Ie,sha512:()=>ke});var l={};r.r(l),r.d(l,{identity:()=>Ue});var p={};r.r(p),r.d(p,{code:()=>Oe,decode:()=>Re,encode:()=>Le,name:()=>Te});var y={};r.r(y),r.d(y,{code:()=>De,decode:()=>Ce,encode:()=>_e,name:()=>Ne});var g={};function w(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function b(e=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?w(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function m(e,t){t||(t=e.reduce(((e,t)=>e+t.length),0));const r=b(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return w(r)}r.r(g),r.d(g,{dQ:()=>_t,ci:()=>kt,bytesToNumberBE:()=>Lt,ty:()=>Rt,eV:()=>Dt,n$:()=>Ht,ql:()=>Nt,hexToBytes:()=>Ot,_t:()=>St,tL:()=>$t,S5:()=>Kt,FF:()=>Vt});const E=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<e.length;o++){var i=e.charAt(o),s=i.charCodeAt(0);if(255!==r[s])throw new TypeError(i+" is ambiguous");r[s]=o}var c=e.length,a=e.charAt(0),f=Math.log(c)/Math.log(256),u=Math.log(256)/Math.log(c);function h(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,o=0;e[t]===a;)n++,t++;for(var i=(e.length-t)*f+1>>>0,s=new Uint8Array(i);e[t];){var u=r[e.charCodeAt(t)];if(255===u)return;for(var h=0,d=i-1;(0!==u||h<o)&&-1!==d;d--,h++)u+=c*s[d]>>>0,s[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");o=h,t++}if(" "!==e[t]){for(var l=i-o;l!==i&&0===s[l];)l++;for(var p=new Uint8Array(n+(i-l)),y=n;l!==i;)p[y++]=s[l++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,o=0,i=t.length;o!==i&&0===t[o];)o++,r++;for(var s=(i-o)*u+1>>>0,f=new Uint8Array(s);o!==i;){for(var h=t[o],d=0,l=s-1;(0!==h||d<n)&&-1!==l;l--,d++)h+=256*f[l]>>>0,f[l]=h%c>>>0,h=h/c>>>0;if(0!==h)throw new Error("Non-zero carry");n=d,o++}for(var p=s-n;p!==s&&0===f[p];)p++;for(var y=a.repeat(r);p<s;++p)y+=e.charAt(f[p]);return y},decodeUnsafe:h,decode:function(e){var r=h(e);if(r)return r;throw new Error(`Non-${t} character`)}}},v=(new Uint8Array(0),e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")});class x{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class A{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return S(this,e)}}class B{constructor(e){this.decoders=e}or(e){return S(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const S=(e,t)=>new B({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class I{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new x(e,t,r),this.decoder=new A(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const k=({name:e,prefix:t,encode:r,decode:n})=>new I(e,t,r,n),P=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:o}=E(r,t);return k({prefix:e,name:t,encode:n,decode:e=>v(o(e))})},U=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>k({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],o=(1<<r)-1;let i="",s=0,c=0;for(let n=0;n<e.length;++n)for(c=c<<8|e[n],s+=8;s>r;)s-=r,i+=t[o&c>>s];if(s&&(i+=t[o&c<<r-s]),n)for(;i.length*r&7;)i+="=";return i})(e,n,r),decode:t=>((e,t,r,n)=>{const o={};for(let e=0;e<t.length;++e)o[t[e]]=e;let i=e.length;for(;"="===e[i-1];)--i;const s=new Uint8Array(i*r/8|0);let c=0,a=0,f=0;for(let t=0;t<i;++t){const i=o[e[t]];if(void 0===i)throw new SyntaxError(`Non-${n} character`);a=a<<r|i,c+=r,c>=8&&(c-=8,s[f++]=255&a>>c)}if(c>=r||255&a<<8-c)throw new SyntaxError("Unexpected end of data");return s})(t,n,r,e)}),T=k({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),O=U({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),L=U({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),R=P({prefix:"9",name:"base10",alphabet:"0123456789"}),$=U({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),K=U({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),N=U({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),D=U({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),_=U({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),C=U({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),j=U({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),H=U({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),W=U({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),V=U({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),J=U({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),q=P({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),z=P({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),F=P({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),M=P({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),G=U({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),X=U({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Z=U({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Y=U({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Q=Array.from("ðŸš€ðŸªâ˜„ðŸ›°ðŸŒŒðŸŒ‘ðŸŒ’ðŸŒ“ðŸŒ”ðŸŒ•ðŸŒ–ðŸŒ—ðŸŒ˜ðŸŒðŸŒðŸŒŽðŸ‰â˜€ðŸ’»ðŸ–¥ðŸ’¾ðŸ’¿ðŸ˜‚â¤ðŸ˜ðŸ¤£ðŸ˜ŠðŸ™ðŸ’•ðŸ˜­ðŸ˜˜ðŸ‘ðŸ˜…ðŸ‘ðŸ˜ðŸ”¥ðŸ¥°ðŸ’”ðŸ’–ðŸ’™ðŸ˜¢ðŸ¤”ðŸ˜†ðŸ™„ðŸ’ªðŸ˜‰â˜ºðŸ‘ŒðŸ¤—ðŸ’œðŸ˜”ðŸ˜ŽðŸ˜‡ðŸŒ¹ðŸ¤¦ðŸŽ‰ðŸ’žâœŒâœ¨ðŸ¤·ðŸ˜±ðŸ˜ŒðŸŒ¸ðŸ™ŒðŸ˜‹ðŸ’—ðŸ’šðŸ˜ðŸ’›ðŸ™‚ðŸ’“ðŸ¤©ðŸ˜„ðŸ˜€ðŸ–¤ðŸ˜ƒðŸ’¯ðŸ™ˆðŸ‘‡ðŸŽ¶ðŸ˜’ðŸ¤­â£ðŸ˜œðŸ’‹ðŸ‘€ðŸ˜ªðŸ˜‘ðŸ’¥ðŸ™‹ðŸ˜žðŸ˜©ðŸ˜¡ðŸ¤ªðŸ‘ŠðŸ¥³ðŸ˜¥ðŸ¤¤ðŸ‘‰ðŸ’ƒðŸ˜³âœ‹ðŸ˜šðŸ˜ðŸ˜´ðŸŒŸðŸ˜¬ðŸ™ƒðŸ€ðŸŒ·ðŸ˜»ðŸ˜“â­âœ…ðŸ¥ºðŸŒˆðŸ˜ˆðŸ¤˜ðŸ’¦âœ”ðŸ˜£ðŸƒðŸ’â˜¹ðŸŽŠðŸ’˜ðŸ˜ â˜ðŸ˜•ðŸŒºðŸŽ‚ðŸŒ»ðŸ˜ðŸ–•ðŸ’ðŸ™ŠðŸ˜¹ðŸ—£ðŸ’«ðŸ’€ðŸ‘‘ðŸŽµðŸ¤žðŸ˜›ðŸ”´ðŸ˜¤ðŸŒ¼ðŸ˜«âš½ðŸ¤™â˜•ðŸ†ðŸ¤«ðŸ‘ˆðŸ˜®ðŸ™†ðŸ»ðŸƒðŸ¶ðŸ’ðŸ˜²ðŸŒ¿ðŸ§¡ðŸŽâš¡ðŸŒžðŸŽˆâŒâœŠðŸ‘‹ðŸ˜°ðŸ¤¨ðŸ˜¶ðŸ¤ðŸš¶ðŸ’°ðŸ“ðŸ’¢ðŸ¤ŸðŸ™ðŸš¨ðŸ’¨ðŸ¤¬âœˆðŸŽ€ðŸºðŸ¤“ðŸ˜™ðŸ’ŸðŸŒ±ðŸ˜–ðŸ‘¶ðŸ¥´â–¶âž¡â“ðŸ’ŽðŸ’¸â¬‡ðŸ˜¨ðŸŒšðŸ¦‹ðŸ˜·ðŸ•ºâš ðŸ™…ðŸ˜ŸðŸ˜µðŸ‘ŽðŸ¤²ðŸ¤ ðŸ¤§ðŸ“ŒðŸ”µðŸ’…ðŸ§ðŸ¾ðŸ’ðŸ˜—ðŸ¤‘ðŸŒŠðŸ¤¯ðŸ·â˜ŽðŸ’§ðŸ˜¯ðŸ’†ðŸ‘†ðŸŽ¤ðŸ™‡ðŸ‘â„ðŸŒ´ðŸ’£ðŸ¸ðŸ’ŒðŸ“ðŸ¥€ðŸ¤¢ðŸ‘…ðŸ’¡ðŸ’©ðŸ‘ðŸ“¸ðŸ‘»ðŸ¤ðŸ¤®ðŸŽ¼ðŸ¥µðŸš©ðŸŽðŸŠðŸ‘¼ðŸ’ðŸ“£ðŸ¥‚"),ee=Q.reduce(((e,t,r)=>(e[r]=t,e)),[]),te=Q.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]),re=k({prefix:"ðŸš€",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+ee[t]),"")},decode:function(e){const t=[];for(const r of e){const e=te[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}});var ne=128,oe=-128,ie=Math.pow(2,31),se=128,ce=127,ae=Math.pow(2,7),fe=Math.pow(2,14),ue=Math.pow(2,21),he=Math.pow(2,28),de=Math.pow(2,35),le=Math.pow(2,42),pe=Math.pow(2,49),ye=Math.pow(2,56),ge=Math.pow(2,63);const we={encode:function e(t,r,n){r=r||[];for(var o=n=n||0;t>=ie;)r[n++]=255&t|ne,t/=128;for(;t&oe;)r[n++]=255&t|ne,t>>>=7;return r[n]=0|t,e.bytes=n-o+1,r},decode:function e(t,r){var n,o=0,i=0,s=r=r||0,c=t.length;do{if(s>=c)throw e.bytes=0,new RangeError("Could not decode varint");n=t[s++],o+=i<28?(n&ce)<<i:(n&ce)*Math.pow(2,i),i+=7}while(n>=se);return e.bytes=s-r,o},encodingLength:function(e){return e<ae?1:e<fe?2:e<ue?3:e<he?4:e<de?5:e<le?6:e<pe?7:e<ye?8:e<ge?9:10}},be=(e,t=0)=>[we.decode(e,t),we.decode.bytes],me=(e,t,r=0)=>(we.encode(e,t,r),t),Ee=e=>we.encodingLength(e),ve=(e,t)=>{const r=t.byteLength,n=Ee(e),o=n+Ee(r),i=new Uint8Array(o+r);return me(e,i,0),me(r,i,n),i.set(t,o),new xe(e,r,t,i)};class xe{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const Ae=({name:e,code:t,encode:r})=>new Be(e,t,r);class Be{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?ve(this.code,t):t.then((e=>ve(this.code,e)))}throw Error("Unknown type, must be binary type")}}const Se=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Ie=Ae({name:"sha2-256",code:18,encode:Se("SHA-256")}),ke=Ae({name:"sha2-512",code:19,encode:Se("SHA-512")}),Pe=v,Ue={code:0,name:"identity",encode:Pe,digest:e=>ve(0,Pe(e))},Te="raw",Oe=85,Le=e=>v(e),Re=e=>v(e),$e=new TextEncoder,Ke=new TextDecoder,Ne="json",De=512,_e=e=>$e.encode(JSON.stringify(e)),Ce=e=>JSON.parse(Ke.decode(e));Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"),Symbol.for("@ipld/js-cid/CID");const je={...e,...t,...o,...i,...s,...c,...a,...f,...u,...h};function He(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const We=He("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),Ve=He("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{const t=b((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t})),Je={utf8:We,"utf-8":We,hex:je.base16,latin1:Ve,ascii:Ve,binary:Ve,...je};function qe(e,t="utf8"){const r=Je[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode(`${r.prefix}${e}`):w(globalThis.Buffer.from(e,"utf-8"))}function ze(e,t="utf8"){const r=Je[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}function Fe(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function Me(e,...t){if(!((r=e)instanceof Uint8Array||null!=r&&"object"==typeof r&&"Uint8Array"===r.constructor.name))throw new Error("Expected Uint8Array");var r;if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function Ge(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Xe(e,t){Me(e);const r=t.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}const Ze="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function Ye(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name}const Qe=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),et=(e,t)=>e<<32-t|e>>>t;if(68!==new Uint8Array(new Uint32Array([287454020]).buffer)[0])throw new Error("Non little-endian hardware is not supported");function tt(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}function rt(e){if("string"==typeof e&&(e=tt(e)),!Ye(e))throw new Error("expected Uint8Array, got "+typeof e);return e}function nt(...e){let t=0;for(let r=0;r<e.length;r++){const n=e[r];if(!Ye(n))throw new Error("Uint8Array expected");t+=n.length}const r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){const o=e[t];r.set(o,n),n+=o.length}return r}class ot{clone(){return this._cloneInto()}}function it(e){const t=t=>e().update(rt(t)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function st(e=32){if(Ze&&"function"==typeof Ze.getRandomValues)return Ze.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}class ct extends ot{constructor(e,t,r,n){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Qe(this.buffer)}update(e){Ge(this);const{view:t,buffer:r,blockLen:n}=this,o=(e=rt(e)).length;for(let i=0;i<o;){const s=Math.min(n-this.pos,o-i);if(s!==n)r.set(e.subarray(i,i+s),this.pos),this.pos+=s,i+=s,this.pos===n&&(this.process(t,0),this.pos=0);else{const t=Qe(e);for(;n<=o-i;i+=n)this.process(t,i)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){Ge(this),Xe(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:n,isLE:o}=this;let{pos:i}=this;t[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>n-i&&(this.process(r,0),i=0);for(let e=i;e<n;e++)t[e]=0;!function(e,t,r,n){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,n);const o=BigInt(32),i=BigInt(4294967295),s=Number(r>>o&i),c=Number(r&i),a=n?4:0,f=n?0:4;e.setUint32(t+a,s,n),e.setUint32(t+f,c,n)}(r,n-8,BigInt(8*this.length),o),this.process(r,0);const s=Qe(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const a=c/4,f=this.get();if(a>f.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<a;e++)s.setUint32(4*e,f[e],o)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:n,finished:o,destroyed:i,pos:s}=this;return e.length=n,e.pos=s,e.finished=o,e.destroyed=i,n%t&&e.buffer.set(r),e}}const at=BigInt(2**32-1),ft=BigInt(32);function ut(e,t=!1){return t?{h:Number(e&at),l:Number(e>>ft&at)}:{h:0|Number(e>>ft&at),l:0|Number(e&at)}}function ht(e,t=!1){let r=new Uint32Array(e.length),n=new Uint32Array(e.length);for(let o=0;o<e.length;o++){const{h:i,l:s}=ut(e[o],t);[r[o],n[o]]=[i,s]}return[r,n]}const dt=(e,t,r)=>e<<r|t>>>32-r,lt=(e,t,r)=>t<<r|e>>>32-r,pt=(e,t,r)=>t<<r-32|e>>>64-r,yt=(e,t,r)=>e<<r-32|t>>>64-r,gt={fromBig:ut,split:ht,toBig:(e,t)=>BigInt(e>>>0)<<ft|BigInt(t>>>0),shrSH:(e,t,r)=>e>>>r,shrSL:(e,t,r)=>e<<32-r|t>>>r,rotrSH:(e,t,r)=>e>>>r|t<<32-r,rotrSL:(e,t,r)=>e<<32-r|t>>>r,rotrBH:(e,t,r)=>e<<64-r|t>>>r-32,rotrBL:(e,t,r)=>e>>>r-32|t<<64-r,rotr32H:(e,t)=>t,rotr32L:(e,t)=>e,rotlSH:dt,rotlSL:lt,rotlBH:pt,rotlBL:yt,add:function(e,t,r,n){const o=(t>>>0)+(n>>>0);return{h:e+r+(o/2**32|0)|0,l:0|o}},add3L:(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),add3H:(e,t,r,n)=>t+r+n+(e/2**32|0)|0,add4L:(e,t,r,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0),add4H:(e,t,r,n,o)=>t+r+n+o+(e/2**32|0)|0,add5H:(e,t,r,n,o,i)=>t+r+n+o+i+(e/2**32|0)|0,add5L:(e,t,r,n,o)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(o>>>0)},[wt,bt]=(()=>gt.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map((e=>BigInt(e)))))(),mt=new Uint32Array(80),Et=new Uint32Array(80);class vt extends ct{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:r,Bl:n,Ch:o,Cl:i,Dh:s,Dl:c,Eh:a,El:f,Fh:u,Fl:h,Gh:d,Gl:l,Hh:p,Hl:y}=this;return[e,t,r,n,o,i,s,c,a,f,u,h,d,l,p,y]}set(e,t,r,n,o,i,s,c,a,f,u,h,d,l,p,y){this.Ah=0|e,this.Al=0|t,this.Bh=0|r,this.Bl=0|n,this.Ch=0|o,this.Cl=0|i,this.Dh=0|s,this.Dl=0|c,this.Eh=0|a,this.El=0|f,this.Fh=0|u,this.Fl=0|h,this.Gh=0|d,this.Gl=0|l,this.Hh=0|p,this.Hl=0|y}process(e,t){for(let r=0;r<16;r++,t+=4)mt[r]=e.getUint32(t),Et[r]=e.getUint32(t+=4);for(let e=16;e<80;e++){const t=0|mt[e-15],r=0|Et[e-15],n=gt.rotrSH(t,r,1)^gt.rotrSH(t,r,8)^gt.shrSH(t,r,7),o=gt.rotrSL(t,r,1)^gt.rotrSL(t,r,8)^gt.shrSL(t,r,7),i=0|mt[e-2],s=0|Et[e-2],c=gt.rotrSH(i,s,19)^gt.rotrBH(i,s,61)^gt.shrSH(i,s,6),a=gt.rotrSL(i,s,19)^gt.rotrBL(i,s,61)^gt.shrSL(i,s,6),f=gt.add4L(o,a,Et[e-7],Et[e-16]),u=gt.add4H(f,n,c,mt[e-7],mt[e-16]);mt[e]=0|u,Et[e]=0|f}let{Ah:r,Al:n,Bh:o,Bl:i,Ch:s,Cl:c,Dh:a,Dl:f,Eh:u,El:h,Fh:d,Fl:l,Gh:p,Gl:y,Hh:g,Hl:w}=this;for(let e=0;e<80;e++){const t=gt.rotrSH(u,h,14)^gt.rotrSH(u,h,18)^gt.rotrBH(u,h,41),b=gt.rotrSL(u,h,14)^gt.rotrSL(u,h,18)^gt.rotrBL(u,h,41),m=u&d^~u&p,E=h&l^~h&y,v=gt.add5L(w,b,E,bt[e],Et[e]),x=gt.add5H(v,g,t,m,wt[e],mt[e]),A=0|v,B=gt.rotrSH(r,n,28)^gt.rotrBH(r,n,34)^gt.rotrBH(r,n,39),S=gt.rotrSL(r,n,28)^gt.rotrBL(r,n,34)^gt.rotrBL(r,n,39),I=r&o^r&s^o&s,k=n&i^n&c^i&c;g=0|p,w=0|y,p=0|d,y=0|l,d=0|u,l=0|h,({h:u,l:h}=gt.add(0|a,0|f,0|x,0|A)),a=0|s,f=0|c,s=0|o,c=0|i,o=0|r,i=0|n;const P=gt.add3L(A,S,k);r=gt.add3H(P,x,B,I),n=0|P}({h:r,l:n}=gt.add(0|this.Ah,0|this.Al,0|r,0|n)),({h:o,l:i}=gt.add(0|this.Bh,0|this.Bl,0|o,0|i)),({h:s,l:c}=gt.add(0|this.Ch,0|this.Cl,0|s,0|c)),({h:a,l:f}=gt.add(0|this.Dh,0|this.Dl,0|a,0|f)),({h:u,l:h}=gt.add(0|this.Eh,0|this.El,0|u,0|h)),({h:d,l}=gt.add(0|this.Fh,0|this.Fl,0|d,0|l)),({h:p,l:y}=gt.add(0|this.Gh,0|this.Gl,0|p,0|y)),({h:g,l:w}=gt.add(0|this.Hh,0|this.Hl,0|g,0|w)),this.set(r,n,o,i,s,c,a,f,u,h,d,l,p,y,g,w)}roundClean(){mt.fill(0),Et.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const xt=it((()=>new vt)),At=(BigInt(0),BigInt(1)),Bt=BigInt(2);function St(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name}const It=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function kt(e){if(!St(e))throw new Error("Uint8Array expected");let t="";for(let r=0;r<e.length;r++)t+=It[e[r]];return t}function Pt(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);return BigInt(""===e?"0":`0x${e}`)}const Ut={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function Tt(e){return e>=Ut._0&&e<=Ut._9?e-Ut._0:e>=Ut._A&&e<=Ut._F?e-(Ut._A-10):e>=Ut._a&&e<=Ut._f?e-(Ut._a-10):void 0}function Ot(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length,r=t/2;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(r);for(let t=0,o=0;t<r;t++,o+=2){const r=Tt(e.charCodeAt(o)),i=Tt(e.charCodeAt(o+1));if(void 0===r||void 0===i){const t=e[o]+e[o+1];throw new Error('hex string expected, got non-hex character "'+t+'" at index '+o)}n[t]=16*r+i}return n}function Lt(e){return Pt(kt(e))}function Rt(e){if(!St(e))throw new Error("Uint8Array expected");return Pt(kt(Uint8Array.from(e).reverse()))}function $t(e,t){return Ot(e.toString(16).padStart(2*t,"0"))}function Kt(e,t){return $t(e,t).reverse()}function Nt(e,t,r){let n;if("string"==typeof t)try{n=Ot(t)}catch(r){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${r}`)}else{if(!St(t))throw new Error(`${e} must be hex string or Uint8Array`);n=Uint8Array.from(t)}const o=n.length;if("number"==typeof r&&o!==r)throw new Error(`${e} expected ${r} bytes, got ${o}`);return n}function Dt(...e){let t=0;for(let r=0;r<e.length;r++){const n=e[r];if(!St(n))throw new Error("Uint8Array expected");t+=n.length}let r=new Uint8Array(t),n=0;for(let t=0;t<e.length;t++){const o=e[t];r.set(o,n),n+=o.length}return r}const _t=e=>(Bt<<BigInt(e-1))-At,Ct=e=>new Uint8Array(e),jt=e=>Uint8Array.from(e);function Ht(e,t,r){if("number"!=typeof e||e<2)throw new Error("hashLen must be a number");if("number"!=typeof t||t<2)throw new Error("qByteLen must be a number");if("function"!=typeof r)throw new Error("hmacFn must be a function");let n=Ct(e),o=Ct(e),i=0;const s=()=>{n.fill(1),o.fill(0),i=0},c=(...e)=>r(o,n,...e),a=(e=Ct())=>{o=c(jt([0]),e),n=c(),0!==e.length&&(o=c(jt([1]),e),n=c())},f=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let e=0;const r=[];for(;e<t;){n=c();const t=n.slice();r.push(t),e+=n.length}return Dt(...r)};return(e,t)=>{let r;for(s(),a(e);!(r=t(f()));)a();return s(),r}}const Wt={bigint:e=>"bigint"==typeof e,function:e=>"function"==typeof e,boolean:e=>"boolean"==typeof e,string:e=>"string"==typeof e,stringOrUint8Array:e=>"string"==typeof e||St(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"==typeof e&&Number.isSafeInteger(e.outputLen)};function Vt(e,t,r={}){const n=(t,r,n)=>{const o=Wt[r];if("function"!=typeof o)throw new Error(`Invalid validator "${r}", expected function`);const i=e[t];if(!(n&&void 0===i||o(i,e)))throw new Error(`Invalid param ${String(t)}=${i} (${typeof i}), expected ${r}`)};for(const[e,r]of Object.entries(t))n(e,r,!1);for(const[e,t]of Object.entries(r))n(e,t,!0);return e}const Jt=BigInt(0),qt=BigInt(1),zt=BigInt(2),Ft=BigInt(3),Mt=BigInt(4),Gt=BigInt(5),Xt=BigInt(8);function Zt(e,t){const r=e%t;return r>=Jt?r:t+r}function Yt(e,t,r){if(r<=Jt||t<Jt)throw new Error("Expected power/modulo > 0");if(r===qt)return Jt;let n=qt;for(;t>Jt;)t&qt&&(n=n*e%r),e=e*e%r,t>>=qt;return n}function Qt(e,t,r){let n=e;for(;t-- >Jt;)n*=n,n%=r;return n}function er(e,t){if(e===Jt||t<=Jt)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let r=Zt(e,t),n=t,o=Jt,i=qt,s=qt,c=Jt;for(;r!==Jt;){const e=n/r,t=n%r,a=o-s*e,f=i-c*e;n=r,r=t,o=s,i=c,s=a,c=f}if(n!==qt)throw new Error("invert: does not exist");return Zt(o,t)}BigInt(9),BigInt(16);const tr=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function rr(e,t){const r=void 0!==t?t:e.toString(2).length;return{nBitLength:r,nByteLength:Math.ceil(r/8)}}function nr(e,t,r=!1,n={}){if(e<=Jt)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:o,nByteLength:i}=rr(e,t);if(i>2048)throw new Error("Field lengths over 2048 bytes are not supported");const s=function(e){if(e%Mt===Ft){const t=(e+qt)/Mt;return function(e,r){const n=e.pow(r,t);if(!e.eql(e.sqr(n),r))throw new Error("Cannot find square root");return n}}if(e%Xt===Gt){const t=(e-Gt)/Xt;return function(e,r){const n=e.mul(r,zt),o=e.pow(n,t),i=e.mul(r,o),s=e.mul(e.mul(i,zt),o),c=e.mul(i,e.sub(s,e.ONE));if(!e.eql(e.sqr(c),r))throw new Error("Cannot find square root");return c}}return function(e){const t=(e-qt)/zt;let r,n,o;for(r=e-qt,n=0;r%zt===Jt;r/=zt,n++);for(o=zt;o<e&&Yt(o,t,e)!==e-qt;o++);if(1===n){const t=(e+qt)/Mt;return function(e,r){const n=e.pow(r,t);if(!e.eql(e.sqr(n),r))throw new Error("Cannot find square root");return n}}const i=(r+qt)/zt;return function(e,s){if(e.pow(s,t)===e.neg(e.ONE))throw new Error("Cannot find square root");let c=n,a=e.pow(e.mul(e.ONE,o),r),f=e.pow(s,i),u=e.pow(s,r);for(;!e.eql(u,e.ONE);){if(e.eql(u,e.ZERO))return e.ZERO;let t=1;for(let r=e.sqr(u);t<c&&!e.eql(r,e.ONE);t++)r=e.sqr(r);const r=e.pow(a,qt<<BigInt(c-t-1));a=e.sqr(r),f=e.mul(f,r),u=e.mul(u,a),c=t}return f}}(e)}(e),c=Object.freeze({ORDER:e,BITS:o,BYTES:i,MASK:_t(o),ZERO:Jt,ONE:qt,create:t=>Zt(t,e),isValid:t=>{if("bigint"!=typeof t)throw new Error("Invalid field element: expected bigint, got "+typeof t);return Jt<=t&&t<e},is0:e=>e===Jt,isOdd:e=>(e&qt)===qt,neg:t=>Zt(-t,e),eql:(e,t)=>e===t,sqr:t=>Zt(t*t,e),add:(t,r)=>Zt(t+r,e),sub:(t,r)=>Zt(t-r,e),mul:(t,r)=>Zt(t*r,e),pow:(e,t)=>function(e,t,r){if(r<Jt)throw new Error("Expected power > 0");if(r===Jt)return e.ONE;if(r===qt)return t;let n=e.ONE,o=t;for(;r>Jt;)r&qt&&(n=e.mul(n,o)),o=e.sqr(o),r>>=qt;return n}(c,e,t),div:(t,r)=>Zt(t*er(r,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>er(t,e),sqrt:n.sqrt||(e=>s(c,e)),invertBatch:e=>function(e,t){const r=new Array(t.length),n=t.reduce(((t,n,o)=>e.is0(n)?t:(r[o]=t,e.mul(t,n))),e.ONE),o=e.inv(n);return t.reduceRight(((t,n,o)=>e.is0(n)?t:(r[o]=e.mul(t,r[o]),e.mul(t,n))),o),r}(c,e),cmov:(e,t,r)=>r?t:e,toBytes:e=>r?Kt(e,i):$t(e,i),fromBytes:e=>{if(e.length!==i)throw new Error(`Fp.fromBytes: expected ${i}, got ${e.length}`);return r?Rt(e):Lt(e)}});return Object.freeze(c)}function or(e){if("bigint"!=typeof e)throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function ir(e){const t=or(e);return t+Math.ceil(t/2)}const sr=BigInt(0),cr=BigInt(1);function ar(e,t){const r=(e,t)=>{const r=t.negate();return e?r:t},n=e=>({windows:Math.ceil(t/e)+1,windowSize:2**(e-1)});return{constTimeNegate:r,unsafeLadder(t,r){let n=e.ZERO,o=t;for(;r>sr;)r&cr&&(n=n.add(o)),o=o.double(),r>>=cr;return n},precomputeWindow(e,t){const{windows:r,windowSize:o}=n(t),i=[];let s=e,c=s;for(let e=0;e<r;e++){c=s,i.push(c);for(let e=1;e<o;e++)c=c.add(s),i.push(c);s=c.double()}return i},wNAF(t,o,i){const{windows:s,windowSize:c}=n(t);let a=e.ZERO,f=e.BASE;const u=BigInt(2**t-1),h=2**t,d=BigInt(t);for(let e=0;e<s;e++){const t=e*c;let n=Number(i&u);i>>=d,n>c&&(n-=h,i+=cr);const s=t,l=t+Math.abs(n)-1,p=e%2!=0,y=n<0;0===n?f=f.add(r(p,o[s])):a=a.add(r(y,o[l]))}return{p:a,f}},wNAFCached(e,t,r,n){const o=e._WINDOW_SIZE||1;let i=t.get(e);return i||(i=this.precomputeWindow(e,o),1!==o&&t.set(e,n(i))),this.wNAF(o,i,r)}}}function fr(e){return Vt(e.Fp,tr.reduce(((e,t)=>(e[t]="function",e)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),Vt(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...rr(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}const ur=BigInt(0),hr=BigInt(1),dr=BigInt(2),lr=BigInt(8),pr={zip215:!0};function yr(e){const t=function(e){const t=fr(e);return Vt(e,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...t})}(e),{Fp:r,n,prehash:o,hash:i,randomBytes:s,nByteLength:c,h:a}=t,f=dr<<BigInt(8*c)-hr,u=r.create,h=t.uvRatio||((e,t)=>{try{return{isValid:!0,value:r.sqrt(e*r.inv(t))}}catch(e){return{isValid:!1,value:ur}}}),d=t.adjustScalarBytes||(e=>e),l=t.domain||((e,t,r)=>{if(t.length||r)throw new Error("Contexts/pre-hash are not supported");return e}),p=e=>"bigint"==typeof e&&ur<e,y=(e,t)=>p(e)&&p(t)&&e<t,g=e=>e===ur||y(e,f);function w(e,t){if(y(e,t))return e;throw new Error(`Expected valid scalar < ${t}, got ${typeof e} ${e}`)}function b(e){return e===ur?e:w(e,n)}const m=new Map;function E(e){if(!(e instanceof v))throw new Error("ExtendedPoint expected")}class v{constructor(e,t,r,n){if(this.ex=e,this.ey=t,this.ez=r,this.et=n,!g(e))throw new Error("x required");if(!g(t))throw new Error("y required");if(!g(r))throw new Error("z required");if(!g(n))throw new Error("t required")}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(e){if(e instanceof v)throw new Error("extended point not allowed");const{x:t,y:r}=e||{};if(!g(t)||!g(r))throw new Error("invalid affine point");return new v(t,r,hr,u(t*r))}static normalizeZ(e){const t=r.invertBatch(e.map((e=>e.ez)));return e.map(((e,r)=>e.toAffine(t[r]))).map(v.fromAffine)}_setWindowSize(e){this._WINDOW_SIZE=e,m.delete(this)}assertValidity(){const{a:e,d:r}=t;if(this.is0())throw new Error("bad point: ZERO");const{ex:n,ey:o,ez:i,et:s}=this,c=u(n*n),a=u(o*o),f=u(i*i),h=u(f*f),d=u(c*e);if(u(f*u(d+a))!==u(h+u(r*u(c*a))))throw new Error("bad point: equation left != right (1)");if(u(n*o)!==u(i*s))throw new Error("bad point: equation left != right (2)")}equals(e){E(e);const{ex:t,ey:r,ez:n}=this,{ex:o,ey:i,ez:s}=e,c=u(t*s),a=u(o*n),f=u(r*s),h=u(i*n);return c===a&&f===h}is0(){return this.equals(v.ZERO)}negate(){return new v(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){const{a:e}=t,{ex:r,ey:n,ez:o}=this,i=u(r*r),s=u(n*n),c=u(dr*u(o*o)),a=u(e*i),f=r+n,h=u(u(f*f)-i-s),d=a+s,l=d-c,p=a-s,y=u(h*l),g=u(d*p),w=u(h*p),b=u(l*d);return new v(y,g,b,w)}add(e){E(e);const{a:r,d:n}=t,{ex:o,ey:i,ez:s,et:c}=this,{ex:a,ey:f,ez:h,et:d}=e;if(r===BigInt(-1)){const e=u((i-o)*(f+a)),t=u((i+o)*(f-a)),r=u(t-e);if(r===ur)return this.double();const n=u(s*dr*d),l=u(c*dr*h),p=l+n,y=t+e,g=l-n,w=u(p*r),b=u(y*g),m=u(p*g),E=u(r*y);return new v(w,b,E,m)}const l=u(o*a),p=u(i*f),y=u(c*n*d),g=u(s*h),w=u((o+i)*(a+f)-l-p),b=g-y,m=g+y,x=u(p-r*l),A=u(w*b),B=u(m*x),S=u(w*x),I=u(b*m);return new v(A,B,I,S)}subtract(e){return this.add(e.negate())}wNAF(e){return B.wNAFCached(this,m,e,v.normalizeZ)}multiply(e){const{p:t,f:r}=this.wNAF(w(e,n));return v.normalizeZ([t,r])[0]}multiplyUnsafe(e){let t=b(e);return t===ur?A:this.equals(A)||t===hr?this:this.equals(x)?this.wNAF(t).p:B.unsafeLadder(this,t)}isSmallOrder(){return this.multiplyUnsafe(a).is0()}isTorsionFree(){return B.unsafeLadder(this,n).is0()}toAffine(e){const{ex:t,ey:n,ez:o}=this,i=this.is0();null==e&&(e=i?lr:r.inv(o));const s=u(t*e),c=u(n*e),a=u(o*e);if(i)return{x:ur,y:hr};if(a!==hr)throw new Error("invZ was invalid");return{x:s,y:c}}clearCofactor(){const{h:e}=t;return e===hr?this:this.multiplyUnsafe(e)}static fromHex(e,n=!1){const{d:o,a:i}=t,s=r.BYTES,c=(e=Nt("pointHex",e,s)).slice(),a=e[s-1];c[s-1]=-129&a;const d=Rt(c);d===ur||w(d,n?f:r.ORDER);const l=u(d*d),p=u(l-hr),y=u(o*l-i);let{isValid:g,value:b}=h(p,y);if(!g)throw new Error("Point.fromHex: invalid y coordinate");const m=(b&hr)===hr,E=0!=(128&a);if(!n&&b===ur&&E)throw new Error("Point.fromHex: x=0 and x_0=1");return E!==m&&(b=u(-b)),v.fromAffine({x:b,y:d})}static fromPrivateKey(e){return k(e).point}toRawBytes(){const{x:e,y:t}=this.toAffine(),n=Kt(t,r.BYTES);return n[n.length-1]|=e&hr?128:0,n}toHex(){return kt(this.toRawBytes())}}v.BASE=new v(t.Gx,t.Gy,hr,u(t.Gx*t.Gy)),v.ZERO=new v(ur,hr,hr,ur);const{BASE:x,ZERO:A}=v,B=ar(v,8*c);function S(e){return Zt(e,n)}function I(e){return S(Rt(e))}function k(e){const t=c;e=Nt("private key",e,t);const r=Nt("hashed private key",i(e),2*t),n=d(r.slice(0,t)),o=r.slice(t,2*t),s=I(n),a=x.multiply(s),f=a.toRawBytes();return{head:n,prefix:o,scalar:s,point:a,pointBytes:f}}function P(e=new Uint8Array,...t){const r=Dt(...t);return I(i(l(r,Nt("context",e),!!o)))}const U=pr;return x._setWindowSize(8),{CURVE:t,getPublicKey:function(e){return k(e).pointBytes},sign:function(e,t,n={}){e=Nt("message",e),o&&(e=o(e));const{prefix:i,scalar:s,pointBytes:a}=k(t),f=P(n.context,i,e),u=x.multiply(f).toRawBytes(),h=S(f+P(n.context,u,a,e)*s);return b(h),Nt("result",Dt(u,Kt(h,r.BYTES)),2*c)},verify:function(e,t,n,i=U){const{context:s,zip215:c}=i,a=r.BYTES;e=Nt("signature",e,2*a),t=Nt("message",t),o&&(t=o(t));const f=Rt(e.slice(a,2*a));let u,h,d;try{u=v.fromHex(n,c),h=v.fromHex(e.slice(0,a),c),d=x.multiplyUnsafe(f)}catch(e){return!1}if(!c&&u.isSmallOrder())return!1;const l=P(s,h.toRawBytes(),u.toRawBytes(),t);return h.add(u.multiplyUnsafe(l)).subtract(d).clearCofactor().equals(v.ZERO)},ExtendedPoint:v,utils:{getExtendedPublicKey:k,randomPrivateKey:()=>s(r.BYTES),precompute:(e=8,t=v.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)}}}const gr=BigInt(0),wr=BigInt(1);const br=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),mr=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),Er=(BigInt(0),BigInt(1)),vr=BigInt(2),xr=BigInt(5),Ar=BigInt(10),Br=BigInt(20),Sr=BigInt(40),Ir=BigInt(80);function kr(e){const t=br,r=e*e%t*e%t,n=Qt(r,vr,t)*r%t,o=Qt(n,Er,t)*e%t,i=Qt(o,xr,t)*o%t,s=Qt(i,Ar,t)*i%t,c=Qt(s,Br,t)*s%t,a=Qt(c,Sr,t)*c%t,f=Qt(a,Ir,t)*a%t,u=Qt(f,Ir,t)*a%t,h=Qt(u,Ar,t)*i%t;return{pow_p_5_8:Qt(h,vr,t)*e%t,b2:r}}function Pr(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}const Ur=nr(br,void 0,!0),Tr=yr({a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:Ur,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:xt,randomBytes:st,adjustScalarBytes:Pr,uvRatio:function(e,t){const r=br,n=Zt(t*t*t,r),o=Zt(n*n*t,r);let i=Zt(e*n*kr(e*o).pow_p_5_8,r);const s=Zt(t*i*i,r),c=i,a=Zt(i*mr,r),f=s===e,u=s===Zt(-e,r),h=s===Zt(-e*mr,r);return f&&(i=c),(u||h)&&(i=a),(Zt(i,r)&qt)===qt&&(i=Zt(-i,r)),{isValid:f||u,value:i}}});const Or=(()=>function(e){const t=(Vt(r=e,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...r}));var r;const{P:n}=t,o=e=>Zt(e,n),i=t.montgomeryBits,s=Math.ceil(i/8),c=t.nByteLength,a=t.adjustScalarBytes||(e=>e),f=t.powPminus2||(e=>Yt(e,n-BigInt(2),n));function u(e,t,r){const n=o(e*(t-r));return[t=o(t-n),r=o(r+n)]}function h(e){if("bigint"==typeof e&&gr<=e&&e<n)return e;throw new Error("Expected valid scalar 0 < scalar < CURVE.P")}const d=(t.a-BigInt(2))/BigInt(4);function l(e){return Kt(o(e),s)}function p(e,t){const r=function(e){const t=Nt("u coordinate",e,s);return 32===c&&(t[31]&=127),Rt(t)}(t),n=function(e){const t=Nt("scalar",e),r=t.length;if(r!==s&&r!==c)throw new Error(`Expected ${s} or ${c} bytes, got ${r}`);return Rt(a(t))}(e),p=function(e,t){const r=h(e),n=h(t),s=r;let c,a=wr,l=gr,p=r,y=wr,g=gr;for(let e=BigInt(i-1);e>=gr;e--){const t=n>>e&wr;g^=t,c=u(g,a,p),a=c[0],p=c[1],c=u(g,l,y),l=c[0],y=c[1],g=t;const r=a+l,i=o(r*r),f=a-l,h=o(f*f),w=i-h,b=p+y,m=o((p-y)*r),E=o(b*f),v=m+E,x=m-E;p=o(v*v),y=o(s*o(x*x)),a=o(i*h),l=o(w*(i+o(d*w)))}c=u(g,a,p),a=c[0],p=c[1],c=u(g,l,y),l=c[0],y=c[1];const w=f(l);return o(a*w)}(r,n);if(p===gr)throw new Error("Invalid private or public key received");return l(p)}const y=l(t.Gu);function g(e){return p(e,y)}return{scalarMult:p,scalarMultBase:g,getSharedSecret:(e,t)=>p(e,t),getPublicKey:e=>g(e),utils:{randomPrivateKey:()=>t.randomBytes(t.nByteLength)},GuBytes:y}}({P:br,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:e=>{const t=br,{pow_p_5_8:r,b2:n}=kr(e);return Zt(Qt(r,BigInt(3),t)*n,t)},adjustScalarBytes:Pr,randomBytes:st}))(),Lr=(Ur.ORDER+BigInt(3))/BigInt(8);Ur.pow(vr,Lr),Ur.sqrt(Ur.neg(Ur.ONE)),Ur.ORDER,BigInt(5),BigInt(8),BigInt(486662),function(e,t){if(!e.isOdd)throw new Error("Field doesn't have isOdd");const r=e.sqrt(t);e.isOdd(r)&&e.neg(r)}(Ur,Ur.neg(BigInt(486664))),BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");var Rr=r(957);const $r=(e,t,r)=>e&t^e&r^t&r,Kr=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Nr=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Dr=new Uint32Array(64);class _r extends ct{constructor(){super(64,32,8,!1),this.A=0|Nr[0],this.B=0|Nr[1],this.C=0|Nr[2],this.D=0|Nr[3],this.E=0|Nr[4],this.F=0|Nr[5],this.G=0|Nr[6],this.H=0|Nr[7]}get(){const{A:e,B:t,C:r,D:n,E:o,F:i,G:s,H:c}=this;return[e,t,r,n,o,i,s,c]}set(e,t,r,n,o,i,s,c){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|n,this.E=0|o,this.F=0|i,this.G=0|s,this.H=0|c}process(e,t){for(let r=0;r<16;r++,t+=4)Dr[r]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=Dr[e-15],r=Dr[e-2],n=et(t,7)^et(t,18)^t>>>3,o=et(r,17)^et(r,19)^r>>>10;Dr[e]=o+Dr[e-7]+n+Dr[e-16]|0}let{A:r,B:n,C:o,D:i,E:s,F:c,G:a,H:f}=this;for(let e=0;e<64;e++){const t=f+(et(s,6)^et(s,11)^et(s,25))+((u=s)&c^~u&a)+Kr[e]+Dr[e]|0,h=(et(r,2)^et(r,13)^et(r,22))+$r(r,n,o)|0;f=a,a=c,c=s,s=i+t|0,i=o,o=n,n=r,r=t+h|0}var u;r=r+this.A|0,n=n+this.B|0,o=o+this.C|0,i=i+this.D|0,s=s+this.E|0,c=c+this.F|0,a=a+this.G|0,f=f+this.H|0,this.set(r,n,o,i,s,c,a,f)}roundClean(){Dr.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Cr=it((()=>new _r));class jr extends ot{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,function(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");Fe(e.outputLen),Fe(e.blockLen)}(e);const r=rt(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const n=this.blockLen,o=new Uint8Array(n);o.set(r.length>n?e.create().update(r).digest():r);for(let e=0;e<o.length;e++)o[e]^=54;this.iHash.update(o),this.oHash=e.create();for(let e=0;e<o.length;e++)o[e]^=106;this.oHash.update(o),o.fill(0)}update(e){return Ge(this),this.iHash.update(e),this}digestInto(e){Ge(this),Me(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:r,finished:n,destroyed:o,blockLen:i,outputLen:s}=this;return e.finished=n,e.destroyed=o,e.blockLen=i,e.outputLen=s,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Hr=(e,t,r)=>new jr(e,t).update(r).digest();Hr.create=(e,t)=>new jr(e,t);const{bytesToNumberBE:Wr,hexToBytes:Vr}=g,Jr={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(e){const{Err:t}=Jr;if(e.length<2||2!==e[0])throw new t("Invalid signature integer tag");const r=e[1],n=e.subarray(2,r+2);if(!r||n.length!==r)throw new t("Invalid signature integer: wrong length");if(128&n[0])throw new t("Invalid signature integer: negative");if(0===n[0]&&!(128&n[1]))throw new t("Invalid signature integer: unnecessary leading zero");return{d:Wr(n),l:e.subarray(r+2)}},toSig(e){const{Err:t}=Jr,r="string"==typeof e?Vr(e):e;if(!St(r))throw new Error("ui8a expected");let n=r.length;if(n<2||48!=r[0])throw new t("Invalid signature tag");if(r[1]!==n-2)throw new t("Invalid signature: incorrect length");const{d:o,l:i}=Jr._parseInt(r.subarray(2)),{d:s,l:c}=Jr._parseInt(i);if(c.length)throw new t("Invalid signature: left bytes after parsing");return{r:o,s}},hexFromSig(e){const t=e=>8&Number.parseInt(e[0],16)?"00"+e:e,r=e=>{const t=e.toString(16);return 1&t.length?`0${t}`:t},n=t(r(e.s)),o=t(r(e.r)),i=n.length/2,s=o.length/2,c=r(i),a=r(s);return`30${r(s+i+4)}02${a}${o}02${c}${n}`}},qr=BigInt(0),zr=BigInt(1),Fr=(BigInt(2),BigInt(3));function Mr(e){const t=function(e){const t=fr(e);return Vt(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}(e),{Fp:r,n}=t,o=r.BYTES+1,i=2*r.BYTES+1;function s(e){return Zt(e,n)}function c(e){return er(e,n)}const{ProjectivePoint:a,normPrivateKeyToScalar:f,weierstrassEquation:u,isWithinCurveOrder:h}=function(e){const t=function(e){const t=fr(e);Vt(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:r,Fp:n,a:o}=t;if(r){if(!n.eql(o,n.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!=typeof r||"bigint"!=typeof r.beta||"function"!=typeof r.splitScalar)throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}(e),{Fp:r}=t,n=t.toBytes||((e,t,n)=>{const o=t.toAffine();return Dt(Uint8Array.from([4]),r.toBytes(o.x),r.toBytes(o.y))}),o=t.fromBytes||(e=>{const t=e.subarray(1);return{x:r.fromBytes(t.subarray(0,r.BYTES)),y:r.fromBytes(t.subarray(r.BYTES,2*r.BYTES))}});function i(e){const{a:n,b:o}=t,i=r.sqr(e),s=r.mul(i,e);return r.add(r.add(s,r.mul(e,n)),o)}if(!r.eql(r.sqr(t.Gy),i(t.Gx)))throw new Error("bad generator point: equation left != right");function s(e){return"bigint"==typeof e&&qr<e&&e<t.n}function c(e){if(!s(e))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function a(e){const{allowedPrivateKeyLengths:r,nByteLength:n,wrapPrivateKey:o,n:i}=t;if(r&&"bigint"!=typeof e){if(St(e)&&(e=kt(e)),"string"!=typeof e||!r.includes(e.length))throw new Error("Invalid key");e=e.padStart(2*n,"0")}let s;try{s="bigint"==typeof e?e:Lt(Nt("private key",e,n))}catch(t){throw new Error(`private key must be ${n} bytes, hex or bigint, not ${typeof e}`)}return o&&(s=Zt(s,i)),c(s),s}const f=new Map;function u(e){if(!(e instanceof h))throw new Error("ProjectivePoint expected")}class h{constructor(e,t,n){if(this.px=e,this.py=t,this.pz=n,null==e||!r.isValid(e))throw new Error("x required");if(null==t||!r.isValid(t))throw new Error("y required");if(null==n||!r.isValid(n))throw new Error("z required")}static fromAffine(e){const{x:t,y:n}=e||{};if(!e||!r.isValid(t)||!r.isValid(n))throw new Error("invalid affine point");if(e instanceof h)throw new Error("projective point not allowed");const o=e=>r.eql(e,r.ZERO);return o(t)&&o(n)?h.ZERO:new h(t,n,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){const t=r.invertBatch(e.map((e=>e.pz)));return e.map(((e,r)=>e.toAffine(t[r]))).map(h.fromAffine)}static fromHex(e){const t=h.fromAffine(o(Nt("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){return h.BASE.multiply(a(e))}_setWindowSize(e){this._WINDOW_SIZE=e,f.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!r.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:e,y:n}=this.toAffine();if(!r.isValid(e)||!r.isValid(n))throw new Error("bad point: x or y not FE");const o=r.sqr(n),s=i(e);if(!r.eql(o,s))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:e}=this.toAffine();if(r.isOdd)return!r.isOdd(e);throw new Error("Field doesn't support isOdd")}equals(e){u(e);const{px:t,py:n,pz:o}=this,{px:i,py:s,pz:c}=e,a=r.eql(r.mul(t,c),r.mul(i,o)),f=r.eql(r.mul(n,c),r.mul(s,o));return a&&f}negate(){return new h(this.px,r.neg(this.py),this.pz)}double(){const{a:e,b:n}=t,o=r.mul(n,Fr),{px:i,py:s,pz:c}=this;let a=r.ZERO,f=r.ZERO,u=r.ZERO,d=r.mul(i,i),l=r.mul(s,s),p=r.mul(c,c),y=r.mul(i,s);return y=r.add(y,y),u=r.mul(i,c),u=r.add(u,u),a=r.mul(e,u),f=r.mul(o,p),f=r.add(a,f),a=r.sub(l,f),f=r.add(l,f),f=r.mul(a,f),a=r.mul(y,a),u=r.mul(o,u),p=r.mul(e,p),y=r.sub(d,p),y=r.mul(e,y),y=r.add(y,u),u=r.add(d,d),d=r.add(u,d),d=r.add(d,p),d=r.mul(d,y),f=r.add(f,d),p=r.mul(s,c),p=r.add(p,p),d=r.mul(p,y),a=r.sub(a,d),u=r.mul(p,l),u=r.add(u,u),u=r.add(u,u),new h(a,f,u)}add(e){u(e);const{px:n,py:o,pz:i}=this,{px:s,py:c,pz:a}=e;let f=r.ZERO,d=r.ZERO,l=r.ZERO;const p=t.a,y=r.mul(t.b,Fr);let g=r.mul(n,s),w=r.mul(o,c),b=r.mul(i,a),m=r.add(n,o),E=r.add(s,c);m=r.mul(m,E),E=r.add(g,w),m=r.sub(m,E),E=r.add(n,i);let v=r.add(s,a);return E=r.mul(E,v),v=r.add(g,b),E=r.sub(E,v),v=r.add(o,i),f=r.add(c,a),v=r.mul(v,f),f=r.add(w,b),v=r.sub(v,f),l=r.mul(p,E),f=r.mul(y,b),l=r.add(f,l),f=r.sub(w,l),l=r.add(w,l),d=r.mul(f,l),w=r.add(g,g),w=r.add(w,g),b=r.mul(p,b),E=r.mul(y,E),w=r.add(w,b),b=r.sub(g,b),b=r.mul(p,b),E=r.add(E,b),g=r.mul(w,E),d=r.add(d,g),g=r.mul(v,E),f=r.mul(m,f),f=r.sub(f,g),g=r.mul(m,w),l=r.mul(v,l),l=r.add(l,g),new h(f,d,l)}subtract(e){return this.add(e.negate())}is0(){return this.equals(h.ZERO)}wNAF(e){return l.wNAFCached(this,f,e,(e=>{const t=r.invertBatch(e.map((e=>e.pz)));return e.map(((e,r)=>e.toAffine(t[r]))).map(h.fromAffine)}))}multiplyUnsafe(e){const n=h.ZERO;if(e===qr)return n;if(c(e),e===zr)return this;const{endo:o}=t;if(!o)return l.unsafeLadder(this,e);let{k1neg:i,k1:s,k2neg:a,k2:f}=o.splitScalar(e),u=n,d=n,p=this;for(;s>qr||f>qr;)s&zr&&(u=u.add(p)),f&zr&&(d=d.add(p)),p=p.double(),s>>=zr,f>>=zr;return i&&(u=u.negate()),a&&(d=d.negate()),d=new h(r.mul(d.px,o.beta),d.py,d.pz),u.add(d)}multiply(e){c(e);let n,o,i=e;const{endo:s}=t;if(s){const{k1neg:e,k1:t,k2neg:c,k2:a}=s.splitScalar(i);let{p:f,f:u}=this.wNAF(t),{p:d,f:p}=this.wNAF(a);f=l.constTimeNegate(e,f),d=l.constTimeNegate(c,d),d=new h(r.mul(d.px,s.beta),d.py,d.pz),n=f.add(d),o=u.add(p)}else{const{p:e,f:t}=this.wNAF(i);n=e,o=t}return h.normalizeZ([n,o])[0]}multiplyAndAddUnsafe(e,t,r){const n=h.BASE,o=(e,t)=>t!==qr&&t!==zr&&e.equals(n)?e.multiply(t):e.multiplyUnsafe(t),i=o(this,t).add(o(e,r));return i.is0()?void 0:i}toAffine(e){const{px:t,py:n,pz:o}=this,i=this.is0();null==e&&(e=i?r.ONE:r.inv(o));const s=r.mul(t,e),c=r.mul(n,e),a=r.mul(o,e);if(i)return{x:r.ZERO,y:r.ZERO};if(!r.eql(a,r.ONE))throw new Error("invZ was invalid");return{x:s,y:c}}isTorsionFree(){const{h:e,isTorsionFree:r}=t;if(e===zr)return!0;if(r)return r(h,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:e,clearCofactor:r}=t;return e===zr?this:r?r(h,this):this.multiplyUnsafe(t.h)}toRawBytes(e=!0){return this.assertValidity(),n(h,this,e)}toHex(e=!0){return kt(this.toRawBytes(e))}}h.BASE=new h(t.Gx,t.Gy,r.ONE),h.ZERO=new h(r.ZERO,r.ONE,r.ZERO);const d=t.nBitLength,l=ar(h,t.endo?Math.ceil(d/2):d);return{CURVE:t,ProjectivePoint:h,normPrivateKeyToScalar:a,weierstrassEquation:i,isWithinCurveOrder:s}}({...t,toBytes(e,t,n){const o=t.toAffine(),i=r.toBytes(o.x),s=Dt;return n?s(Uint8Array.from([t.hasEvenY()?2:3]),i):s(Uint8Array.from([4]),i,r.toBytes(o.y))},fromBytes(e){const t=e.length,n=e[0],s=e.subarray(1);if(t!==o||2!==n&&3!==n){if(t===i&&4===n)return{x:r.fromBytes(s.subarray(0,r.BYTES)),y:r.fromBytes(s.subarray(r.BYTES,2*r.BYTES))};throw new Error(`Point of length ${t} was invalid. Expected ${o} compressed bytes or ${i} uncompressed bytes`)}{const e=Lt(s);if(!(qr<(c=e)&&c<r.ORDER))throw new Error("Point is not on curve");const t=u(e);let o=r.sqrt(t);return 1==(1&n)!=((o&zr)===zr)&&(o=r.neg(o)),{x:e,y:o}}var c}}),d=e=>kt($t(e,t.nByteLength));function l(e){return e>n>>zr}const p=(e,t,r)=>Lt(e.slice(t,r));class y{constructor(e,t,r){this.r=e,this.s=t,this.recovery=r,this.assertValidity()}static fromCompact(e){const r=t.nByteLength;return e=Nt("compactSignature",e,2*r),new y(p(e,0,r),p(e,r,2*r))}static fromDER(e){const{r:t,s:r}=Jr.toSig(Nt("DER",e));return new y(t,r)}assertValidity(){if(!h(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!h(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(e){return new y(this.r,this.s,e)}recoverPublicKey(e){const{r:n,s:o,recovery:i}=this,f=m(Nt("msgHash",e));if(null==i||![0,1,2,3].includes(i))throw new Error("recovery id invalid");const u=2===i||3===i?n+t.n:n;if(u>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const h=0==(1&i)?"02":"03",l=a.fromHex(h+d(u)),p=c(u),y=s(-f*p),g=s(o*p),w=a.BASE.multiplyAndAddUnsafe(l,y,g);if(!w)throw new Error("point at infinify");return w.assertValidity(),w}hasHighS(){return l(this.s)}normalizeS(){return this.hasHighS()?new y(this.r,s(-this.s),this.recovery):this}toDERRawBytes(){return Ot(this.toDERHex())}toDERHex(){return Jr.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Ot(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const g={isValidPrivateKey(e){try{return f(e),!0}catch(e){return!1}},normPrivateKeyToScalar:f,randomPrivateKey:()=>{const e=ir(t.n);return function(e,t,r=!1){const n=e.length,o=or(t),i=ir(t);if(n<16||n<i||n>1024)throw new Error(`expected ${i}-1024 bytes of input, got ${n}`);const s=Zt(r?Lt(e):Rt(e),t-qt)+qt;return r?Kt(s,o):$t(s,o)}(t.randomBytes(e),t.n)},precompute:(e=8,t=a.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)};function w(e){const t=St(e),r="string"==typeof e,n=(t||r)&&e.length;return t?n===o||n===i:r?n===2*o||n===2*i:e instanceof a}const b=t.bits2int||function(e){const r=Lt(e),n=8*e.length-t.nBitLength;return n>0?r>>BigInt(n):r},m=t.bits2int_modN||function(e){return s(b(e))},E=_t(t.nBitLength);function v(e){if("bigint"!=typeof e)throw new Error("bigint expected");if(!(qr<=e&&e<E))throw new Error(`bigint expected < 2^${t.nBitLength}`);return $t(e,t.nByteLength)}const x={lowS:t.lowS,prehash:!1},A={lowS:t.lowS,prehash:!1};return a.BASE._setWindowSize(8),{CURVE:t,getPublicKey:function(e,t=!0){return a.fromPrivateKey(e).toRawBytes(t)},getSharedSecret:function(e,t,r=!0){if(w(e))throw new Error("first arg must be private key");if(!w(t))throw new Error("second arg must be public key");return a.fromHex(t).multiply(f(e)).toRawBytes(r)},sign:function(e,n,o=x){const{seed:i,k2sig:u}=function(e,n,o=x){if(["recovered","canonical"].some((e=>e in o)))throw new Error("sign() legacy options not supported");const{hash:i,randomBytes:u}=t;let{lowS:d,prehash:p,extraEntropy:g}=o;null==d&&(d=!0),e=Nt("msgHash",e),p&&(e=Nt("prehashed msgHash",i(e)));const w=m(e),E=f(n),A=[v(E),v(w)];if(null!=g){const e=!0===g?u(r.BYTES):g;A.push(Nt("extraEntropy",e))}const B=Dt(...A),S=w;return{seed:B,k2sig:function(e){const t=b(e);if(!h(t))return;const r=c(t),n=a.BASE.multiply(t).toAffine(),o=s(n.x);if(o===qr)return;const i=s(r*s(S+o*E));if(i===qr)return;let f=(n.x===o?0:2)|Number(n.y&zr),u=i;return d&&l(i)&&(u=function(e){return l(e)?s(-e):e}(i),f^=1),new y(o,u,f)}}}(e,n,o),d=t;return Ht(d.hash.outputLen,d.nByteLength,d.hmac)(i,u)},verify:function(e,r,n,o=A){const i=e;if(r=Nt("msgHash",r),n=Nt("publicKey",n),"strict"in o)throw new Error("options.strict was renamed to lowS");const{lowS:f,prehash:u}=o;let h,d;try{if("string"==typeof i||St(i))try{h=y.fromDER(i)}catch(e){if(!(e instanceof Jr.Err))throw e;h=y.fromCompact(i)}else{if("object"!=typeof i||"bigint"!=typeof i.r||"bigint"!=typeof i.s)throw new Error("PARSE");{const{r:e,s:t}=i;h=new y(e,t)}}d=a.fromHex(n)}catch(e){if("PARSE"===e.message)throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(f&&h.hasHighS())return!1;u&&(r=t.hash(r));const{r:l,s:p}=h,g=m(r),w=c(p),b=s(g*w),E=s(l*w),v=a.BASE.multiplyAndAddUnsafe(d,b,E)?.toAffine();return!!v&&s(v.x)===l},ProjectivePoint:a,Signature:y,utils:g}}function Gr(e){return{hash:e,hmac:(t,...r)=>Hr(e,t,nt(...r)),randomBytes:st}}function Xr(e,t){const r=t=>Mr({...e,...Gr(t)});return Object.freeze({...r(t),create:r})}BigInt(4);const Zr=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Yr=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Qr=BigInt(1),en=BigInt(2),tn=(e,t)=>(e+t/en)/t;const rn=nr(Zr,void 0,void 0,{sqrt:function(e){const t=Zr,r=BigInt(3),n=BigInt(6),o=BigInt(11),i=BigInt(22),s=BigInt(23),c=BigInt(44),a=BigInt(88),f=e*e*e%t,u=f*f*e%t,h=Qt(u,r,t)*u%t,d=Qt(h,r,t)*u%t,l=Qt(d,en,t)*f%t,p=Qt(l,o,t)*l%t,y=Qt(p,i,t)*p%t,g=Qt(y,c,t)*y%t,w=Qt(g,a,t)*g%t,b=Qt(w,c,t)*y%t,m=Qt(b,r,t)*u%t,E=Qt(m,s,t)*p%t,v=Qt(E,n,t)*f%t,x=Qt(v,en,t);if(!rn.eql(rn.sqr(x),e))throw new Error("Cannot find square root");return x}}),nn=Xr({a:BigInt(0),b:BigInt(7),Fp:rn,n:Yr,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=Yr,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-Qr*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=r,s=BigInt("0x100000000000000000000000000000000"),c=tn(i*e,t),a=tn(-n*e,t);let f=Zt(e-c*r-a*o,t),u=Zt(-c*n-a*i,t);const h=f>s,d=u>s;if(h&&(f=t-f),d&&(u=t-u),f>s||u>s)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:h,k1:f,k2neg:d,k2:u}}}},Cr);BigInt(0),nn.ProjectivePoint;const on=nr(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),sn=Xr({a:on.create(BigInt("-3")),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Fp:on,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},Cr),cn=new Uint8Array([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),an=Uint8Array.from({length:16},((e,t)=>t));let fn=[an],un=[an.map((e=>(9*e+5)%16))];for(let e=0;e<4;e++)for(let t of[fn,un])t.push(t[e].map((e=>cn[e])));const hn=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map((e=>new Uint8Array(e))),dn=fn.map(((e,t)=>e.map((e=>hn[t][e])))),ln=un.map(((e,t)=>e.map((e=>hn[t][e])))),pn=new Uint32Array([0,1518500249,1859775393,2400959708,2840853838]),yn=new Uint32Array([1352829926,1548603684,1836072691,2053994217,0]),gn=(e,t)=>e<<t|e>>>32-t;function wn(e,t,r,n){return 0===e?t^r^n:1===e?t&r|~t&n:2===e?(t|~r)^n:3===e?t&n|r&~n:t^(r|~n)}const bn=new Uint32Array(16);class mn extends ct{constructor(){super(64,20,8,!0),this.h0=1732584193,this.h1=-271733879,this.h2=-1732584194,this.h3=271733878,this.h4=-1009589776}get(){const{h0:e,h1:t,h2:r,h3:n,h4:o}=this;return[e,t,r,n,o]}set(e,t,r,n,o){this.h0=0|e,this.h1=0|t,this.h2=0|r,this.h3=0|n,this.h4=0|o}process(e,t){for(let r=0;r<16;r++,t+=4)bn[r]=e.getUint32(t,!0);let r=0|this.h0,n=r,o=0|this.h1,i=o,s=0|this.h2,c=s,a=0|this.h3,f=a,u=0|this.h4,h=u;for(let e=0;e<5;e++){const t=4-e,d=pn[e],l=yn[e],p=fn[e],y=un[e],g=dn[e],w=ln[e];for(let t=0;t<16;t++){const n=gn(r+wn(e,o,s,a)+bn[p[t]]+d,g[t])+u|0;r=u,u=a,a=0|gn(s,10),s=o,o=n}for(let e=0;e<16;e++){const r=gn(n+wn(t,i,c,f)+bn[y[e]]+l,w[e])+h|0;n=h,h=f,f=0|gn(c,10),c=i,i=r}}this.set(this.h1+s+f|0,this.h2+a+h|0,this.h3+u+n|0,this.h4+r+i|0,this.h0+o+c|0)}roundClean(){bn.fill(0)}destroy(){this.destroyed=!0,this.buffer.fill(0),this.set(0,0,0,0,0)}}const En=it((()=>new mn)),[vn,xn,An]=[[],[],[]],Bn=BigInt(0),Sn=BigInt(1),In=BigInt(2),kn=BigInt(7),Pn=BigInt(256),Un=BigInt(113);for(let e=0,t=Sn,r=1,n=0;e<24;e++){[r,n]=[n,(2*r+3*n)%5],vn.push(2*(5*n+r)),xn.push((e+1)*(e+2)/2%64);let o=Bn;for(let e=0;e<7;e++)t=(t<<Sn^(t>>kn)*Un)%Pn,t&In&&(o^=Sn<<(Sn<<BigInt(e))-Sn);An.push(o)}const[Tn,On]=ht(An,!0),Ln=(e,t,r)=>r>32?pt(e,t,r):dt(e,t,r),Rn=(e,t,r)=>r>32?yt(e,t,r):lt(e,t,r);class $n extends ot{constructor(e,t,r,n=!1,o=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=r,this.enableXOF=n,this.rounds=o,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Fe(r),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");var i;this.state=new Uint8Array(200),this.state32=(i=this.state,new Uint32Array(i.buffer,i.byteOffset,Math.floor(i.byteLength/4)))}keccak(){!function(e,t=24){const r=new Uint32Array(10);for(let n=24-t;n<24;n++){for(let t=0;t<10;t++)r[t]=e[t]^e[t+10]^e[t+20]^e[t+30]^e[t+40];for(let t=0;t<10;t+=2){const n=(t+8)%10,o=(t+2)%10,i=r[o],s=r[o+1],c=Ln(i,s,1)^r[n],a=Rn(i,s,1)^r[n+1];for(let r=0;r<50;r+=10)e[t+r]^=c,e[t+r+1]^=a}let t=e[2],o=e[3];for(let r=0;r<24;r++){const n=xn[r],i=Ln(t,o,n),s=Rn(t,o,n),c=vn[r];t=e[c],o=e[c+1],e[c]=i,e[c+1]=s}for(let t=0;t<50;t+=10){for(let n=0;n<10;n++)r[n]=e[t+n];for(let n=0;n<10;n++)e[t+n]^=~r[(n+2)%10]&r[(n+4)%10]}e[0]^=Tn[n],e[1]^=On[n]}r.fill(0)}(this.state32,this.rounds),this.posOut=0,this.pos=0}update(e){Ge(this);const{blockLen:t,state:r}=this,n=(e=rt(e)).length;for(let o=0;o<n;){const i=Math.min(t-this.pos,n-o);for(let t=0;t<i;t++)r[this.pos++]^=e[o++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:r,blockLen:n}=this;e[r]^=t,0!=(128&t)&&r===n-1&&this.keccak(),e[n-1]^=128,this.keccak()}writeInto(e){Ge(this,!1),Me(e),this.finish();const t=this.state,{blockLen:r}=this;for(let n=0,o=e.length;n<o;){this.posOut>=r&&this.keccak();const i=Math.min(r-this.posOut,o-n);e.set(t.subarray(this.posOut,this.posOut+i),n),this.posOut+=i,n+=i}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Fe(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Xe(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:t,suffix:r,outputLen:n,rounds:o,enableXOF:i}=this;return e||(e=new $n(t,r,n,i,o)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=o,e.suffix=r,e.outputLen=n,e.enableXOF=i,e.destroyed=this.destroyed,e}}const Kn=((e,t,r)=>it((()=>new $n(t,e,r))))(1,136,32);var Nn=r(456);const Dn="(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))",_n="[a-zA-Z0-9_.:%-]",Cn=new RegExp(`^did:([a-z0-9]+):((?:${Dn}*:)*(${Dn}+))((;${_n}+=${_n}*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$`);function jn(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function Hn(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name}function Wn(...e){const t=e=>e,r=(e,t)=>r=>e(t(r));return{encode:e.map((e=>e.encode)).reduceRight(r,t),decode:e.map((e=>e.decode)).reduce(r,t)}}function Vn(e){return{encode:t=>{if(!Array.isArray(t)||t.length&&"number"!=typeof t[0])throw new Error("alphabet.encode input should be an array of numbers");return t.map((t=>{if(jn(t),t<0||t>=e.length)throw new Error(`Digit index outside alphabet: ${t} (alphabet: ${e.length})`);return e[t]}))},decode:t=>{if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw new Error("alphabet.decode input should be array of strings");return t.map((t=>{if("string"!=typeof t)throw new Error(`alphabet.decode: not string element=${t}`);const r=e.indexOf(t);if(-1===r)throw new Error(`Unknown letter: "${t}". Allowed: ${e}`);return r}))}}}function Jn(e=""){if("string"!=typeof e)throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw new Error("join.encode input should be array of strings");for(let e of t)if("string"!=typeof e)throw new Error(`join.encode: non-string input=${e}`);return t.join(e)},decode:t=>{if("string"!=typeof t)throw new Error("join.decode input should be string");return t.split(e)}}}function qn(e,t="="){if(jn(e),"string"!=typeof t)throw new Error("padding chr should be string");return{encode(r){if(!Array.isArray(r)||r.length&&"string"!=typeof r[0])throw new Error("padding.encode input should be array of strings");for(let e of r)if("string"!=typeof e)throw new Error(`padding.encode: non-string input=${e}`);for(;r.length*e%8;)r.push(t);return r},decode(r){if(!Array.isArray(r)||r.length&&"string"!=typeof r[0])throw new Error("padding.encode input should be array of strings");for(let e of r)if("string"!=typeof e)throw new Error(`padding.decode: non-string input=${e}`);let n=r.length;if(n*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;n>0&&r[n-1]===t;n--)if(!((n-1)*e%8))throw new Error("Invalid padding: string has too much padding");return r.slice(0,n)}}}function zn(e){if("function"!=typeof e)throw new Error("normalize fn should be function");return{encode:e=>e,decode:t=>e(t)}}function Fn(e,t,r){if(t<2)throw new Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: wrong to=${r}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let n=0;const o=[],i=Array.from(e);for(i.forEach((e=>{if(jn(e),e<0||e>=t)throw new Error(`Wrong integer: ${e}`)}));;){let e=0,s=!0;for(let o=n;o<i.length;o++){const n=i[o],c=t*e+n;if(!Number.isSafeInteger(c)||t*e/t!==e||c-n!=t*e)throw new Error("convertRadix: carry overflow");c%r;const a=Math.floor(c/r);if(i[o]=a,!Number.isSafeInteger(a)||a*r+e!==c)throw new Error("convertRadix: carry overflow");s&&(a?!1:o)}if(o.push(e),s)break}for(let t=0;t<e.length-1&&0===e[t];t++)o.push(0);return o.reverse()}const Mn=(e,t)=>t?Mn(t,e%t):e,Gn=(e,t)=>e+(t-Mn(e,t));function Xn(e,t,r,n){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(Gn(t,r)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${r} carryBits=${Gn(t,r)}`);let o=0,i=0;const s=2**r-1,c=[];for(const n of e){if(jn(n),n>=2**t)throw new Error(`convertRadix2: invalid data word=${n} from=${t}`);if(o=o<<t|n,i+t>32)throw new Error(`convertRadix2: carry overflow pos=${i} from=${t}`);for(i+=t;i>=r;i-=r)c.push((o>>i-r&s)>>>0);o&=2**i-1}if(o=o<<r-i&s,!n&&i>=t)throw new Error("Excess padding");if(!n&&o)throw new Error(`Non-zero padding: ${o}`);return n&&i>0&&c.push(o>>>0),c}function Zn(e,t=!1){if(jn(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(Gn(8,e)>32||Gn(e,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!Hn(r))throw new Error("radix2.encode input should be Uint8Array");return Xn(Array.from(r),8,e,!t)},decode:r=>{if(!Array.isArray(r)||r.length&&"number"!=typeof r[0])throw new Error("radix2.decode input should be array of numbers");return Uint8Array.from(Xn(r,e,8,t))}}}function Yn(e){if("function"!=typeof e)throw new Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch(e){}}}Zn(4),Vn("0123456789ABCDEF"),Jn(""),Zn(5),Vn("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),qn(5),Jn(""),Zn(5),Vn("0123456789ABCDEFGHIJKLMNOPQRSTUV"),qn(5),Jn(""),Zn(5),Vn("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),Jn(""),zn((e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))),Zn(6),Vn("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),qn(6),Jn(""),Zn(6),Vn("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),qn(6),Jn(""),Zn(6),Vn("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Jn("");const Qn=Wn(Vn("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),Jn("")),eo=[996825010,642813549,513874426,1027748829,705979059];function to(e){const t=e>>25;let r=(33554431&e)<<5;for(let e=0;e<eo.length;e++)1==(t>>e&1)&&(r^=eo[e]);return r}function ro(e,t,r=1){const n=e.length;let o=1;for(let t=0;t<n;t++){const r=e.charCodeAt(t);if(r<33||r>126)throw new Error(`Invalid prefix (${e})`);o=to(o)^r>>5}o=to(o);for(let t=0;t<n;t++)o=to(o)^31&e.charCodeAt(t);for(let e of t)o=to(o)^e;for(let e=0;e<6;e++)o=to(o);return o^=r,Qn.encode(Xn([o%2**30],30,5,!1))}function no(e){const t="bech32"===e?1:734539939,r=Zn(5),n=r.decode,o=r.encode,i=Yn(n);function s(e,r=90){if("string"!=typeof e)throw new Error("bech32.decode input should be string, not "+typeof e);if(e.length<8||!1!==r&&e.length>r)throw new TypeError(`Wrong string length: ${e.length} (${e}). Expected (8..${r})`);const n=e.toLowerCase();if(e!==n&&e!==e.toUpperCase())throw new Error("String must be lowercase or uppercase");const o=(e=n).lastIndexOf("1");if(0===o||-1===o)throw new Error('Letter "1" must be present between prefix and data only');const i=e.slice(0,o),s=e.slice(o+1);if(s.length<6)throw new Error("Data must be at least 6 characters long");const c=Qn.decode(s).slice(0,-6),a=ro(i,c,t);if(!s.endsWith(a))throw new Error(`Invalid checksum in ${e}: expected "${a}"`);return{prefix:i,words:c}}return{encode:function(e,r,n=90){if("string"!=typeof e)throw new Error("bech32.encode prefix should be string, not "+typeof e);if(!Array.isArray(r)||r.length&&"number"!=typeof r[0])throw new Error("bech32.encode words should be array of numbers, not "+typeof r);const o=e.length+7+r.length;if(!1!==n&&o>n)throw new TypeError(`Length ${o} exceeds limit ${n}`);const i=e.toLowerCase(),s=ro(i,r,t);return`${i}1${Qn.encode(r)}${s}`},decode:s,decodeToBytes:function(e){const{prefix:t,words:r}=s(e,!1);return{prefix:t,words:r,bytes:n(r)}},decodeUnsafe:Yn(s),fromWords:n,fromWordsUnsafe:i,toWords:o}}const oo=no("bech32"),io=(Zn(4),Vn("0123456789abcdef"),Jn(""),zn((e=>{if("string"!=typeof e||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})),e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)));function so(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name}if(68!==new Uint8Array(new Uint32Array([287454020]).buffer)[0])throw new Error("Non little-endian hardware is not supported");function co(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}function ao(e){if("string"==typeof e)e=co(e);else{if(!so(e))throw new Error("expected Uint8Array, got "+typeof e);e=e.slice()}return e}function fo(e,t){if(!so(e))throw new Error("Uint8Array expected");if("number"==typeof t&&e.length!==t)throw new Error(`Uint8Array length ${t} expected`)}const uo=(e,t)=>(Object.assign(t,e),t);function ho(e,t,r,n){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,n);const o=BigInt(32),i=BigInt(4294967295),s=Number(r>>o&i),c=Number(r&i),a=n?4:0,f=n?0:4;e.setUint32(t+a,s,n),e.setUint32(t+f,c,n)}function lo(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`wrong positive integer: ${e}`)}function po(e){if("boolean"!=typeof e)throw new Error(`boolean expected, not ${e}`)}function yo(e,...t){if(null==(r=e)||"object"!=typeof r||!(r instanceof Uint8Array||"Uint8Array"===r.constructor.name))throw new Error("Uint8Array expected");var r;if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}function go(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}const wo=(e,t)=>255&e[t++]|(255&e[t++])<<8;class bo{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,fo(e=ao(e),32);const t=wo(e,0),r=wo(e,2),n=wo(e,4),o=wo(e,6),i=wo(e,8),s=wo(e,10),c=wo(e,12),a=wo(e,14);this.r[0]=8191&t,this.r[1]=8191&(t>>>13|r<<3),this.r[2]=7939&(r>>>10|n<<6),this.r[3]=8191&(n>>>7|o<<9),this.r[4]=255&(o>>>4|i<<12),this.r[5]=i>>>1&8190,this.r[6]=8191&(i>>>14|s<<2),this.r[7]=8065&(s>>>11|c<<5),this.r[8]=8191&(c>>>8|a<<8),this.r[9]=a>>>5&127;for(let t=0;t<8;t++)this.pad[t]=wo(e,16+2*t)}process(e,t,r=!1){const n=r?0:2048,{h:o,r:i}=this,s=i[0],c=i[1],a=i[2],f=i[3],u=i[4],h=i[5],d=i[6],l=i[7],p=i[8],y=i[9],g=wo(e,t+0),w=wo(e,t+2),b=wo(e,t+4),m=wo(e,t+6),E=wo(e,t+8),v=wo(e,t+10),x=wo(e,t+12),A=wo(e,t+14);let B=o[0]+(8191&g),S=o[1]+(8191&(g>>>13|w<<3)),I=o[2]+(8191&(w>>>10|b<<6)),k=o[3]+(8191&(b>>>7|m<<9)),P=o[4]+(8191&(m>>>4|E<<12)),U=o[5]+(E>>>1&8191),T=o[6]+(8191&(E>>>14|v<<2)),O=o[7]+(8191&(v>>>11|x<<5)),L=o[8]+(8191&(x>>>8|A<<8)),R=o[9]+(A>>>5|n),$=0,K=$+B*s+S*(5*y)+I*(5*p)+k*(5*l)+P*(5*d);$=K>>>13,K&=8191,K+=U*(5*h)+T*(5*u)+O*(5*f)+L*(5*a)+R*(5*c),$+=K>>>13,K&=8191;let N=$+B*c+S*s+I*(5*y)+k*(5*p)+P*(5*l);$=N>>>13,N&=8191,N+=U*(5*d)+T*(5*h)+O*(5*u)+L*(5*f)+R*(5*a),$+=N>>>13,N&=8191;let D=$+B*a+S*c+I*s+k*(5*y)+P*(5*p);$=D>>>13,D&=8191,D+=U*(5*l)+T*(5*d)+O*(5*h)+L*(5*u)+R*(5*f),$+=D>>>13,D&=8191;let _=$+B*f+S*a+I*c+k*s+P*(5*y);$=_>>>13,_&=8191,_+=U*(5*p)+T*(5*l)+O*(5*d)+L*(5*h)+R*(5*u),$+=_>>>13,_&=8191;let C=$+B*u+S*f+I*a+k*c+P*s;$=C>>>13,C&=8191,C+=U*(5*y)+T*(5*p)+O*(5*l)+L*(5*d)+R*(5*h),$+=C>>>13,C&=8191;let j=$+B*h+S*u+I*f+k*a+P*c;$=j>>>13,j&=8191,j+=U*s+T*(5*y)+O*(5*p)+L*(5*l)+R*(5*d),$+=j>>>13,j&=8191;let H=$+B*d+S*h+I*u+k*f+P*a;$=H>>>13,H&=8191,H+=U*c+T*s+O*(5*y)+L*(5*p)+R*(5*l),$+=H>>>13,H&=8191;let W=$+B*l+S*d+I*h+k*u+P*f;$=W>>>13,W&=8191,W+=U*a+T*c+O*s+L*(5*y)+R*(5*p),$+=W>>>13,W&=8191;let V=$+B*p+S*l+I*d+k*h+P*u;$=V>>>13,V&=8191,V+=U*f+T*a+O*c+L*s+R*(5*y),$+=V>>>13,V&=8191;let J=$+B*y+S*p+I*l+k*d+P*h;$=J>>>13,J&=8191,J+=U*u+T*f+O*a+L*c+R*s,$+=J>>>13,J&=8191,$=($<<2)+$|0,$=$+K|0,K=8191&$,$>>>=13,N+=$,o[0]=K,o[1]=N,o[2]=D,o[3]=_,o[4]=C,o[5]=j,o[6]=H,o[7]=W,o[8]=V,o[9]=J}finalize(){const{h:e,pad:t}=this,r=new Uint16Array(10);let n=e[1]>>>13;e[1]&=8191;for(let t=2;t<10;t++)e[t]+=n,n=e[t]>>>13,e[t]&=8191;e[0]+=5*n,n=e[0]>>>13,e[0]&=8191,e[1]+=n,n=e[1]>>>13,e[1]&=8191,e[2]+=n,r[0]=e[0]+5,n=r[0]>>>13,r[0]&=8191;for(let t=1;t<10;t++)r[t]=e[t]+n,n=r[t]>>>13,r[t]&=8191;r[9]-=8192;let o=(1^n)-1;for(let e=0;e<10;e++)r[e]&=o;o=~o;for(let t=0;t<10;t++)e[t]=e[t]&o|r[t];e[0]=65535&(e[0]|e[1]<<13),e[1]=65535&(e[1]>>>3|e[2]<<10),e[2]=65535&(e[2]>>>6|e[3]<<7),e[3]=65535&(e[3]>>>9|e[4]<<4),e[4]=65535&(e[4]>>>12|e[5]<<1|e[6]<<14),e[5]=65535&(e[6]>>>2|e[7]<<11),e[6]=65535&(e[7]>>>5|e[8]<<8),e[7]=65535&(e[8]>>>8|e[9]<<5);let i=e[0]+t[0];e[0]=65535&i;for(let r=1;r<8;r++)i=(e[r]+t[r]|0)+(i>>>16)|0,e[r]=65535&i}update(e){go(this);const{buffer:t,blockLen:r}=this,n=(e=ao(e)).length;for(let o=0;o<n;){const i=Math.min(r-this.pos,n-o);if(i!==r)t.set(e.subarray(o,o+i),this.pos),this.pos+=i,o+=i,this.pos===r&&(this.process(t,0,!1),this.pos=0);else for(;r<=n-o;o+=r)this.process(e,o)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(e){go(this),function(e,t){yo(e);const r=t.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}(e,this),this.finished=!0;const{buffer:t,h:r}=this;let{pos:n}=this;if(n){for(t[n++]=1;n<16;n++)t[n]=0;this.process(t,0,!0)}this.finalize();let o=0;for(let t=0;t<8;t++)e[o++]=r[t]>>>0,e[o++]=r[t]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}}const mo=function(e){const t=(t,r)=>e(r).update(ao(t)).digest(),r=e(new Uint8Array(32));return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=t=>e(t),t}((e=>new bo(e))),Eo=co("expand 16-byte k"),vo=co("expand 32-byte k"),xo=io(Eo),Ao=io(vo);function Bo(e,t){return e<<t|e>>>32-t}function So(e){return e.byteOffset%4==0}const Io=2**32-1,ko=new Uint32Array;function Po(e,t){const{allowShortKeys:r,extendNonceFn:n,counterLength:o,counterRight:i,rounds:s}=function(e,t){if(void 0!==t&&("object"!=typeof t||(r=t,"[object Object]"!==Object.prototype.toString.call(r)||r.constructor!==Object)))throw new Error("options must be object or undefined");var r;return Object.assign({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t)}(0,t);if("function"!=typeof e)throw new Error("core must be a function");return lo(o),lo(s),po(i),po(r),(t,c,a,f,u=0)=>{yo(t),yo(c),yo(a);const h=a.length;if(f||(f=new Uint8Array(h)),yo(f),lo(u),u<0||u>=Io)throw new Error("arx: counter overflow");if(f.length<h)throw new Error(`arx: output (${f.length}) is shorter than data (${h})`);const d=[];let l,p,y=t.length;if(32===y)l=t.slice(),d.push(l),p=Ao;else{if(16!==y||!r)throw new Error(`arx: invalid 32-byte key, got length=${y}`);l=new Uint8Array(32),l.set(t),l.set(t,16),p=xo,d.push(l)}So(c)||(c=c.slice(),d.push(c));const g=io(l);if(n){if(24!==c.length)throw new Error("arx: extended nonce must be 24 bytes");n(p,g,io(c.subarray(0,16)),g),c=c.subarray(16)}const w=16-o;if(w!==c.length)throw new Error(`arx: nonce must be ${w} or 16 bytes`);if(12!==w){const e=new Uint8Array(12);e.set(c,i?0:12-c.length),c=e,d.push(c)}const b=io(c);for(function(e,t,r,n,o,i,s,c){const a=o.length,f=new Uint8Array(64),u=io(f),h=So(o)&&So(i),d=h?io(o):ko,l=h?io(i):ko;for(let p=0;p<a;s++){if(e(t,r,n,u,s,c),s>=Io)throw new Error("arx: counter overflow");const y=Math.min(64,a-p);if(h&&64===y){const e=p/4;if(p%4!=0)throw new Error("arx: invalid block position");for(let t,r=0;r<16;r++)t=e+r,l[t]=d[t]^u[r];p+=64}else{for(let e,t=0;t<y;t++)e=p+t,i[e]=o[e]^f[t];p+=y}}}(e,p,g,b,a,f,u,s);d.length>0;)d.pop().fill(0);return f}}function Uo(e,t,r,n,o,i=20){let s=e[0],c=e[1],a=e[2],f=e[3],u=t[0],h=t[1],d=t[2],l=t[3],p=t[4],y=t[5],g=t[6],w=t[7],b=o,m=r[0],E=r[1],v=r[2],x=s,A=c,B=a,S=f,I=u,k=h,P=d,U=l,T=p,O=y,L=g,R=w,$=b,K=m,N=E,D=v;for(let e=0;e<i;e+=2)x=x+I|0,$=Bo($^x,16),T=T+$|0,I=Bo(I^T,12),x=x+I|0,$=Bo($^x,8),T=T+$|0,I=Bo(I^T,7),A=A+k|0,K=Bo(K^A,16),O=O+K|0,k=Bo(k^O,12),A=A+k|0,K=Bo(K^A,8),O=O+K|0,k=Bo(k^O,7),B=B+P|0,N=Bo(N^B,16),L=L+N|0,P=Bo(P^L,12),B=B+P|0,N=Bo(N^B,8),L=L+N|0,P=Bo(P^L,7),S=S+U|0,D=Bo(D^S,16),R=R+D|0,U=Bo(U^R,12),S=S+U|0,D=Bo(D^S,8),R=R+D|0,U=Bo(U^R,7),x=x+k|0,D=Bo(D^x,16),L=L+D|0,k=Bo(k^L,12),x=x+k|0,D=Bo(D^x,8),L=L+D|0,k=Bo(k^L,7),A=A+P|0,$=Bo($^A,16),R=R+$|0,P=Bo(P^R,12),A=A+P|0,$=Bo($^A,8),R=R+$|0,P=Bo(P^R,7),B=B+U|0,K=Bo(K^B,16),T=T+K|0,U=Bo(U^T,12),B=B+U|0,K=Bo(K^B,8),T=T+K|0,U=Bo(U^T,7),S=S+I|0,N=Bo(N^S,16),O=O+N|0,I=Bo(I^O,12),S=S+I|0,N=Bo(N^S,8),O=O+N|0,I=Bo(I^O,7);let _=0;n[_++]=s+x|0,n[_++]=c+A|0,n[_++]=a+B|0,n[_++]=f+S|0,n[_++]=u+I|0,n[_++]=h+k|0,n[_++]=d+P|0,n[_++]=l+U|0,n[_++]=p+T|0,n[_++]=y+O|0,n[_++]=g+L|0,n[_++]=w+R|0,n[_++]=b+$|0,n[_++]=m+K|0,n[_++]=E+N|0,n[_++]=v+D|0}const To=Po(Uo,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Oo=Po(Uo,{counterRight:!1,counterLength:8,extendNonceFn:function(e,t,r,n){let o=e[0],i=e[1],s=e[2],c=e[3],a=t[0],f=t[1],u=t[2],h=t[3],d=t[4],l=t[5],p=t[6],y=t[7],g=r[0],w=r[1],b=r[2],m=r[3];for(let e=0;e<20;e+=2)o=o+a|0,g=Bo(g^o,16),d=d+g|0,a=Bo(a^d,12),o=o+a|0,g=Bo(g^o,8),d=d+g|0,a=Bo(a^d,7),i=i+f|0,w=Bo(w^i,16),l=l+w|0,f=Bo(f^l,12),i=i+f|0,w=Bo(w^i,8),l=l+w|0,f=Bo(f^l,7),s=s+u|0,b=Bo(b^s,16),p=p+b|0,u=Bo(u^p,12),s=s+u|0,b=Bo(b^s,8),p=p+b|0,u=Bo(u^p,7),c=c+h|0,m=Bo(m^c,16),y=y+m|0,h=Bo(h^y,12),c=c+h|0,m=Bo(m^c,8),y=y+m|0,h=Bo(h^y,7),o=o+f|0,m=Bo(m^o,16),p=p+m|0,f=Bo(f^p,12),o=o+f|0,m=Bo(m^o,8),p=p+m|0,f=Bo(f^p,7),i=i+u|0,g=Bo(g^i,16),y=y+g|0,u=Bo(u^y,12),i=i+u|0,g=Bo(g^i,8),y=y+g|0,u=Bo(u^y,7),s=s+h|0,w=Bo(w^s,16),d=d+w|0,h=Bo(h^d,12),s=s+h|0,w=Bo(w^s,8),d=d+w|0,h=Bo(h^d,7),c=c+a|0,b=Bo(b^c,16),l=l+b|0,a=Bo(a^l,12),c=c+a|0,b=Bo(b^c,8),l=l+b|0,a=Bo(a^l,7);let E=0;n[E++]=o,n[E++]=i,n[E++]=s,n[E++]=c,n[E++]=g,n[E++]=w,n[E++]=b,n[E++]=m},allowShortKeys:!1}),Lo=new Uint8Array(16),Ro=(e,t)=>{e.update(t);const r=t.length%16;r&&e.update(Lo.subarray(r))},$o=new Uint8Array(32);function Ko(e,t,r,n,o){const i=e(t,r,$o),s=mo.create(i);o&&Ro(s,o),Ro(s,n);const c=new Uint8Array(16),a=(f=c,new DataView(f.buffer,f.byteOffset,f.byteLength));var f;ho(a,0,BigInt(o?o.length:0),!0),ho(a,8,BigInt(n.length),!0),s.update(c);const u=s.digest();return i.fill(0),u}const No=e=>(t,r,n)=>(fo(t,32),fo(r),{encrypt:(o,i)=>{const s=o.length,c=s+16;i?fo(i,c):i=new Uint8Array(c),e(t,r,o,i,1);const a=Ko(e,t,r,i.subarray(0,-16),n);return i.set(a,s),i},decrypt:(o,i)=>{const s=o.length,c=s-16;if(s<16)throw new Error("encrypted data must be at least 16 bytes");i?fo(i,c):i=new Uint8Array(c);const a=o.subarray(0,-16);if(!function(e,t){if(e.length!==t.length)return!1;let r=0;for(let n=0;n<e.length;n++)r|=e[n]^t[n];return 0===r}(o.subarray(-16),Ko(e,t,r,a,n)))throw new Error("invalid tag");return e(t,r,a,i,1),i}}),Do=(No(To),uo({blockSize:64,nonceLength:24,tagLength:16},No(Oo))),_o={toString:ze,fromString:qe,concat:m};function Co(e){return _o.toString(e,"base64url")}function jo(e){const t=e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"");return _o.fromString(t,"base64url")}function Ho(e){return _o.fromString(e,"base58btc")}function Wo(e){return _o.toString(e,"base58btc")}const Vo={ES256:["JsonWebKey2020","Multikey","EcdsaSecp256r1VerificationKey2019"],ES256K:["EcdsaSecp256k1VerificationKey2019","EcdsaSecp256k1RecoveryMethod2020","Secp256k1VerificationKey2018","Secp256k1SignatureVerificationKey2018","EcdsaPublicKeySecp256k1","JsonWebKey2020","Multikey"],"ES256K-R":["EcdsaSecp256k1VerificationKey2019","EcdsaSecp256k1RecoveryMethod2020","Secp256k1VerificationKey2018","Secp256k1SignatureVerificationKey2018","EcdsaPublicKeySecp256k1","ConditionalProof2022","JsonWebKey2020","Multikey"],Ed25519:["ED25519SignatureVerification","Ed25519VerificationKey2018","Ed25519VerificationKey2020","JsonWebKey2020","Multikey"],EdDSA:["ED25519SignatureVerification","Ed25519VerificationKey2018","Ed25519VerificationKey2020","JsonWebKey2020","Multikey"]},Jo={Secp256k1SignatureVerificationKey2018:"Secp256k1",Secp256k1VerificationKey2018:"Secp256k1",EcdsaSecp256k1VerificationKey2019:"Secp256k1",EcdsaPublicKeySecp256k1:"Secp256k1",EcdsaSecp256k1RecoveryMethod2020:"Secp256k1",EcdsaSecp256r1VerificationKey2019:"P-256",Ed25519VerificationKey2018:"Ed25519",Ed25519VerificationKey2020:"Ed25519",ED25519SignatureVerification:"Ed25519",X25519KeyAgreementKey2019:"X25519",X25519KeyAgreementKey2020:"X25519",ConditionalProof2022:void 0,JsonWebKey2020:void 0,Multikey:void 0},qo={"ed25519-pub":237,"x25519-pub":236,"secp256k1-pub":231,"bls12_381-g1-pub":234,"bls12_381-g2-pub":235,"p256-pub":4608},zo={"bls12_381-g1-pub":"Bls12381G1","bls12_381-g2-pub":"Bls12381G2","ed25519-pub":"Ed25519","p256-pub":"P-256","secp256k1-pub":"Secp256k1","x25519-pub":"X25519"};function Fo(e){if(e.publicKeyBase58)return{keyBytes:Ho(e.publicKeyBase58),keyType:Jo[e.type]};if(e.publicKeyBase64)return{keyBytes:jo(e.publicKeyBase64),keyType:Jo[e.type]};if(e.publicKeyHex)return{keyBytes:Xo(e.publicKeyHex),keyType:Jo[e.type]};if(e.publicKeyJwk&&"secp256k1"===e.publicKeyJwk.crv&&e.publicKeyJwk.x&&e.publicKeyJwk.y)return{keyBytes:nn.ProjectivePoint.fromAffine({x:ei(jo(e.publicKeyJwk.x)),y:ei(jo(e.publicKeyJwk.y))}).toRawBytes(!1),keyType:"Secp256k1"};if(e.publicKeyJwk&&"P-256"===e.publicKeyJwk.crv&&e.publicKeyJwk.x&&e.publicKeyJwk.y)return{keyBytes:sn.ProjectivePoint.fromAffine({x:ei(jo(e.publicKeyJwk.x)),y:ei(jo(e.publicKeyJwk.y))}).toRawBytes(!1),keyType:"P-256"};if(e.publicKeyJwk&&"OKP"===e.publicKeyJwk.kty&&["Ed25519","X25519"].includes(e.publicKeyJwk.crv??"")&&e.publicKeyJwk.x)return{keyBytes:jo(e.publicKeyJwk.x),keyType:e.publicKeyJwk.crv};if(e.publicKeyMultibase){const{keyBytes:t,keyType:r}=Go(e.publicKeyMultibase);return{keyBytes:t,keyType:r??Jo[e.type]}}return{keyBytes:new Uint8Array}}function Mo(e,t="base58btc",r){if(r){const n="string"==typeof r?qo[r]:r,o=Ee(n),i=new Uint8Array(o+e.length);return me(n,i),i.set(e,o),_o.toString((0,Rr.encode)(t,i),"utf-8")}return _o.toString((0,Rr.encode)(t,e),"utf-8")}function Go(e){const t=(0,Rr.decode)(e);if([32,33,48,64,65,96].includes(t.length))return{keyBytes:t};try{const[e,r]=be(t),n=Object.entries(qo).filter((([,t])=>t===e))?.[0][0]??"";return{keyBytes:t.slice(r),keyType:zo[n]}}catch(e){return{keyBytes:t}}}function Xo(e,t){let r=e.startsWith("0x")?e.substring(2):e;if(r.length%2!=0&&(r=`0${r}`),t){const e=Math.max(r.length,2*t);r=r.padStart(e,"00")}return _o.fromString(r.toLowerCase(),"base16")}function Zo(e){return Co(_o.fromString(e))}function Yo(e){return _o.toString(jo(e))}function Qo(e){return _o.toString(e,"base16")}function ei(e){return BigInt("0x"+_o.toString(e,"base16"))}function ti(e){return _o.fromString(e,"utf-8")}function ri({r:e,s:t,recoveryParam:r},n){const o=new Uint8Array(n?65:64);if(o.set(_o.fromString(e,"base16"),0),o.set(_o.fromString(t,"base16"),32),n){if(void 0===r)throw new Error("Signer did not return a recoveryParam");o[64]=r}return Co(o)}function ni(e){const t=jo(e);if(t.length<64||t.length>65)throw new TypeError(`Wrong size for signature. Expected 64 or 65 bytes, but got ${t.length}`);return{r:Qo(t.slice(0,32)),s:Qo(t.slice(32,64)),recoveryParam:65===t.length?t[64]:void 0}}function oi(e,t){return _o.concat([jo(e),t?jo(t):new Uint8Array(0)])}function ii(e,t=64){return e.length===t?e:"0".repeat(t-e.length)+e}function si(){const e=Or.utils.randomPrivateKey();return{secretKey:e,publicKey:Or.getPublicKey(e)}}function ci(e){if(32!==e.length)throw new Error("x25519: seed must be 32 bytes");return{publicKey:Or.getPublicKey(e),secretKey:e}}function ai(){const e=si();return{publicKeyJWK:{kty:"OKP",crv:"X25519",x:Co(e.publicKey)},secretKey:e.secretKey}}function fi(e){return null!=e}function ui(e){const t="string"==typeof e?qe(e):e;return Cr(t)}const hi=Kn;function di(e){const t=qe(e.slice(2),"base16");return`0x${ze(hi(t).slice(-20),"base16")}`}function li(e,t=new Uint8Array(4)){const r=qe(e.toString(),"base10");return t.set(r,4-r.length),t}const pi=e=>m([li(e.length),e]);function yi(e,t,r,n,o){if(256!==t)throw new Error(`Unsupported key length: ${t}`);const i=m([pi(qe(r)),pi(void 0===n?new Uint8Array(0):n),pi(void 0===o?new Uint8Array(0):o),li(t)]);return ui(m([li(1),e,i]))}function gi(e,t=!1){const r=e;if(32!==r.length)throw new Error(`bad_key: Invalid private key format. Expecting 32 bytes, but got ${r.length}`);return function(e){try{const n=nn.sign(ui(e),r);return Promise.resolve(ri({r:ii(n.r.toString(16)),s:ii(n.s.toString(16)),recoveryParam:n.recovery},t))}catch(e){return Promise.reject(e)}}}function wi(e){const t=gi(Xo(e),!0);return function(e){try{return Promise.resolve(t(e)).then(ni)}catch(e){return Promise.reject(e)}}}function bi(e){return gi(Xo(e))}function mi(e){const t=e;if(![32,64].includes(t.length))throw new Error(`bad_key: Invalid private key format. Expecting 32 or 64 bytes, but got ${t.length}`);return function(e){try{const r="string"==typeof e?ti(e):e,n=Tr.sign(r,t.slice(0,32));return Promise.resolve(Co(n))}catch(e){return Promise.reject(e)}}}function Ei(e){return mi(jo(e))}function vi(e){if(32!==e.length)throw new Error(`bad_key: Invalid private key format. Expecting 32 bytes, but got ${e.length}`);return function(t){try{const r=sn.sign(ui(t),e);return Promise.resolve(ri({r:ii(r.r.toString(16)),s:ii(r.s.toString(16))}))}catch(e){return Promise.reject(e)}}}function xi(e){return"object"==typeof e&&"r"in e&&"s"in e}function Ai(e){return function(t,r){try{return Promise.resolve(r(t)).then((function(t){if(xi(t))return ri(t,e);if(e&&void 0===ni(t).recoveryParam)throw new Error("not_supported: ES256K-R not supported when signer doesn't provide a recovery param");return t}))}catch(e){return Promise.reject(e)}}}function Bi(){return function(e,t){try{return Promise.resolve(t(e)).then((function(e){if(xi(e))throw new Error("invalid_config: expected a signer function that returns a string instead of signature object");return e}))}catch(e){return Promise.reject(e)}}}const Si={ES256:function(e,t){try{return Promise.resolve(t(e)).then((function(e){return xi(e)?ri(e):e}))}catch(e){return Promise.reject(e)}},ES256K:Ai(),"ES256K-R":Ai(!0),Ed25519:Bi(),EdDSA:Bi()};function Ii(e,t=!1){const r=jo(e);if(r.length!==(t?65:64))throw new Error("wrong signature length");return{compact:r.slice(0,64),recovery:r[64]}}function ki(e,t,r){const n=[];if(t.length>86)n.push(Ii(t,!0));else{const e=Ii(t,!1);n.push({...e,recovery:0}),n.push({...e,recovery:1})}const o=ui(e),i=e=>{const t=nn.Signature.fromCompact(e.compact).addRecoveryBit(e.recovery||0).recoverPublicKey(o),n=di(t.toHex(!1)).toLowerCase(),i=t.toHex(!1),s=t.toHex(!0);return r.find((e=>{const{keyBytes:t}=Fo(e),r=Qo(t);return r===i||r===s||e.ethereumAddress?.toLowerCase()===n||e.blockchainAccountId?.split("@eip155")?.[0].toLowerCase()===n||function(e,t){if(t){const r=t.split(":");switch(r[0]){case"bip122":r[r.length-1]=function(e,t){const r=Qo(Ho(t).slice(0,1)),n=Xo(e),o=r+Qo(En(ui(n))),i=ui(Xo(o));return Wo(Xo(o+Qo(ui(i)).substring(0,8)))}(e,r[r.length-1]);break;case"cosmos":r[r.length-1]=function(e,t){const r=nn.ProjectivePoint.fromHex(e).toRawBytes(),n=En(ui(r)),o=oo.toWords(n);return oo.encode(t,o).replace(t,"")}(e,r[1]);break;case"eip155":r[r.length-1]=di(e);break;default:return!1}return r.join(":").toLowerCase()===t.toLowerCase()}return!1}(i,e.blockchainAccountId)}))};for(const e of n){const t=i(e);if(t)return t}throw new Error("invalid_signature: Signature invalid for JWT")}function Pi(e,t,r){const n=ti(e),o=jo(t),i=r.find((e=>{const{keyBytes:t,keyType:r}=Fo(e);return"Ed25519"===r&&Tr.verify(o,n,t)}));if(!i)throw new Error("invalid_signature: Signature invalid for JWT");return i}const Ui={ES256:function(e,t,r){const n=ui(e),o=sn.Signature.fromCompact(Ii(t).compact),i=r.filter((e=>!e.ethereumAddress&&!e.blockchainAccountId)).find((e=>{try{const{keyBytes:t}=Fo(e);return sn.verify(o,n,t)}catch(e){return!1}}));if(!i)throw new Error("invalid_signature: Signature invalid for JWT");return i},ES256K:function(e,t,r){const n=ui(e),o=nn.Signature.fromCompact(jo(t)).normalizeS(),i=r.filter((e=>!e.ethereumAddress&&!e.blockchainAccountId)),s=r.filter((e=>e.ethereumAddress||e.blockchainAccountId));let c=i.find((e=>{try{const{keyBytes:t}=Fo(e);return nn.verify(o,n,t)}catch(e){return!1}}));if(!c&&s.length>0&&(c=ki(e,t,s)),!c)throw new Error("invalid_signature: Signature invalid for JWT");return c},"ES256K-R":ki,Ed25519:Pi,EdDSA:Pi};function Ti(e){const t=Ui[e];if(!t)throw new Error(`not_supported: Unsupported algorithm ${e}`);return t}Ti.toSignatureObject=function(e,t=!1){const r=jo(e);if(r.length!==(t?65:64))throw new Error("wrong signature length");const n={r:Qo(r.slice(0,32)),s:Qo(r.slice(32,64))};return t&&(n.recoveryParam=r[64]),n};const Oi={INVALID_JWT:"invalid_jwt",INVALID_AUDIENCE:"invalid_config",INVALID_SIGNATURE:"invalid_signature",NO_SUITABLE_KEYS:"no_suitable_keys",NOT_SUPPORTED:"not_supported",RESOLVER_ERROR:"resolver_error"},Li="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function Ri(e,t,r){if(!e.s){if(r instanceof $i){if(!r.s)return void(r.o=Ri.bind(null,e,t));1&t&&(t=r.s),r=r.v}if(r&&r.then)return void r.then(Ri.bind(null,e,t),Ri.bind(null,e,2));e.s=t,e.v=r;const n=e.o;n&&n(e)}}const $i=function(){function e(){}return e.prototype.then=function(t,r){const n=new e,o=this.s;if(o){const e=1&o?t:r;if(e){try{Ri(n,1,e(this.v))}catch(e){Ri(n,2,e)}return n}return this}return this.o=function(e){try{const o=e.v;1&e.s?Ri(n,1,t?t(o):o):r?Ri(n,1,r(o)):Ri(n,2,o)}catch(e){Ri(n,2,e)}},n},e}();function Ki(e){return e instanceof $i&&1&e.s}const Ni=function(e,{header:t,payload:r,data:n,signature:o},i,s){try{let a;function c(e){if(a)return e;throw new Error(`${Oi.INVALID_SIGNATURE}: condition for authenticator ${i.id} is not met.`)}if(!i.conditionWeightedThreshold||!i.threshold)throw new Error("Expected conditionWeightedThreshold and threshold");const f=[],u=i.threshold;let h=0;const d=function(e,t,r){if("function"==typeof e[Li]){var n,o,i,s=e[Li]();if(function e(c){try{for(;!((n=s.next()).done||r&&r());)if((c=t(n.value))&&c.then){if(!Ki(c))return void c.then(e,i||(i=Ri.bind(null,o=new $i,2)));c=c.v}o?Ri(o,1,c):o=c}catch(e){Ri(o||(o=new $i),2,e)}}(),s.return){var c=function(e){try{n.done||s.return()}catch(e){}return e};if(o&&o.then)return o.then(c,(function(e){throw c(e)}));c()}return o}if(!("length"in e))throw new TypeError("Object is not iterable");for(var a=[],f=0;f<e.length;f++)a.push(e[f]);return function(e,t,r){var n,o,i=-1;return function s(c){try{for(;++i<e.length&&(!r||!r());)if((c=t(i))&&c.then){if(!Ki(c))return void c.then(s,o||(o=Ri.bind(null,n=new $i,2)));c=c.v}n?Ri(n,1,c):n=c}catch(e){Ri(n||(n=new $i),2,e)}}(),n}(a,(function(e){return t(a[e])}),r)}(i.conditionWeightedThreshold,(function(c){function d(e){return a?e:p&&!f.includes(p.id)&&(f.push(p.id),h+=c.weight,h>=u)?(a=1,i):void 0}const l=c.condition;let p;const y=function(i,c){try{var a=function(){if(l.type===_i){if(!s.didAuthenticator)throw new Error("Expected didAuthenticator");const t={...s,didAuthenticator:{didResolutionResult:s.didAuthenticator?.didResolutionResult,authenticators:[l],issuer:l.id}};return Promise.resolve(Vi(e,t)).then((function({verified:e}){e&&(p=l)}))}return Promise.resolve(rs({header:t,payload:r,data:n,signature:o},l)).then((function(e){p=e}))}()}catch(e){return c(e)}return a&&a.then?a.then(void 0,c):a}(0,(function(e){if(!e.message.startsWith(Oi.INVALID_SIGNATURE))throw e}));return y&&y.then?y.then(d):d(y)}),(function(){return a}));return Promise.resolve(d&&d.then?d.then(c):c(d))}catch(l){return Promise.reject(l)}},Di=function(e,{header:t,payload:r,signature:n,data:o},i,s){try{return i.type===_i?function(e,{header:t,payload:r,signature:n,data:o},i,s){try{if(i.conditionWeightedThreshold)return Ni(e,{header:t,payload:r,data:o,signature:n},i,s);if(i.conditionDelegated)return function(e,{header:t,payload:r,data:n,signature:o},i,s){try{if(!i.conditionDelegated)throw new Error("Expected conditionDelegated");if(!s.resolver)throw new Error("Expected resolver");let c;const a=i.conditionDelegated;return Promise.resolve(Wi(s.resolver,t.alg,a,s.proofPurpose)).then((function(f){function u(e){if(c)return i;throw new Error(`${Oi.INVALID_SIGNATURE}: condition for authenticator ${i.id} is not met.`)}const h=f.didResolutionResult;if(!h?.didDocument)throw new Error(`${Oi.RESOLVER_ERROR}: Could not resolve delegated DID ${a}.`);const d=f.authenticators.find((e=>e.id===a));if(!d)throw new Error(`${Oi.NO_SUITABLE_KEYS}: Could not find delegated authenticator ${a} in it's DID Document`);const l=function(){if(d.type===_i)return Promise.resolve(Vi(e,{...s,didAuthenticator:{didResolutionResult:h,authenticators:[d],issuer:d.id}})).then((function({verified:e}){e&&(c=d)}));try{c=rs({header:t,payload:r,data:n,signature:o},d)}catch(e){if(!e.message.startsWith("invalid_signature:"))throw e}}();return l&&l.then?l.then(u):u()}))}catch(e){return Promise.reject(e)}}(e,{header:t,payload:r,data:o,signature:n},i,s);throw new Error(`${Oi.INVALID_JWT}: conditional proof type did not find condition for authenticator ${i.id}.`)}catch(e){return Promise.reject(e)}}(e,{payload:r,header:t,signature:n,data:o},i,s):Promise.resolve(rs({header:t,payload:r,data:o,signature:n},[i]))}catch(e){return Promise.reject(e)}},_i="ConditionalProof2022";function Ci(e,t,r){if(!e.s){if(r instanceof ji){if(!r.s)return void(r.o=Ci.bind(null,e,t));1&t&&(t=r.s),r=r.v}if(r&&r.then)return void r.then(Ci.bind(null,e,t),Ci.bind(null,e,2));e.s=t,e.v=r;const n=e.o;n&&n(e)}}const ji=function(){function e(){}return e.prototype.then=function(t,r){const n=new e,o=this.s;if(o){const e=1&o?t:r;if(e){try{Ci(n,1,e(this.v))}catch(e){Ci(n,2,e)}return n}return this}return this.o=function(e){try{const o=e.v;1&e.s?Ci(n,1,t?t(o):o):r?Ci(n,1,r(o)):Ci(n,2,o)}catch(e){Ci(n,2,e)}},n},e}();function Hi(e){return e instanceof ji&&1&e.s}const Wi=function(e,t,r,n){try{const o=Vo[t];if(!o||0===o.length)throw new Error(`${Oi.NOT_SUPPORTED}: No supported signature types for algorithm ${t}`);let i;return Promise.resolve(e.resolve(r,{accept:Zi})).then((function(e){if(i=-1===Object.getOwnPropertyNames(e).indexOf("didDocument")?{didDocument:e,didDocumentMetadata:{},didResolutionMetadata:{contentType:Zi}}:e,i.didResolutionMetadata?.error||null==i.didDocument){const{error:e,message:t}=i.didResolutionMetadata;throw new Error(`${Oi.RESOLVER_ERROR}: Unable to resolve DID document for ${r}: ${e}, ${t||""}`)}const s=(e,t)=>{const r=e.filter((({id:e})=>t===e));return r.length>0?r[0]:null};let c=[...i?.didDocument?.verificationMethod||[],...i?.didDocument?.publicKey||[]];"string"==typeof n&&(n.startsWith("assertion")&&!Object.getOwnPropertyNames(i?.didDocument).includes("assertionMethod")&&(i.didDocument={...i.didDocument},i.didDocument.assertionMethod=[...c.map((e=>e.id))]),c=(i.didDocument[n]||[]).map((e=>"string"==typeof e?s(c,e):"string"==typeof e.publicKey?s(c,e.publicKey):e)).filter((e=>null!=e)));const a=c.filter((({type:e})=>o.find((t=>t===e))));if("string"==typeof n&&(!a||0===a.length))throw new Error(`${Oi.NO_SUITABLE_KEYS}: DID document for ${r} does not have public keys suitable for ${t} with ${n} purpose`);if(!a||0===a.length)throw new Error(`${Oi.NO_SUITABLE_KEYS}: DID document for ${r} does not have public keys for ${t}`);return{authenticators:a,issuer:r,didResolutionResult:i}}))}catch(e){return Promise.reject(e)}},Vi=function(e,t={resolver:void 0,auth:void 0,audience:void 0,callbackUrl:void 0,skewTime:void 0,proofPurpose:void 0,policies:{},didAuthenticator:void 0}){try{function r(){function r(r){if(d){const r="number"==typeof t.policies?.now?t.policies.now:Math.floor(Date.now()/1e3),o=void 0!==t.skewTime&&t.skewTime>=0?t.skewTime:Qi,i=r+o;if(!1!==t.policies?.nbf&&n.nbf){if(n.nbf>i)throw new Error(`${Oi.INVALID_JWT}: JWT not valid before nbf: ${n.nbf}`)}else if(!1!==t.policies?.iat&&n.iat&&n.iat>i)throw new Error(`${Oi.INVALID_JWT}: JWT not valid yet (issued in the future) iat: ${n.iat}`);if(!1!==t.policies?.exp&&n.exp&&n.exp<=r-o)throw new Error(`${Oi.INVALID_JWT}: JWT has expired: exp: ${n.exp} < now: ${r}`);if(!1!==t.policies?.aud&&n.aud){if(!t.audience&&!t.callbackUrl)throw new Error(`${Oi.INVALID_AUDIENCE}: JWT audience is required but your app address has not been configured`);if(void 0===(Array.isArray(n.aud)?n.aud:[n.aud]).find((e=>t.audience===e||t.callbackUrl===e)))throw new Error(`${Oi.INVALID_AUDIENCE}: JWT audience does not match your DID or callback url`)}return{verified:!0,payload:n,didResolutionResult:h,issuer:u,signer:d,jwt:e,policies:t.policies}}throw new Error(`${Oi.INVALID_SIGNATURE}: JWT not valid. issuer DID document does not contain a verificationMethod that matches the signature.`)}const{did:c}=function(e){if(""===e||!e)return null;const t=e.match(Cn);if(t){const r={did:`did:${t[1]}:${t[2]}`,method:t[1],id:t[2],didUrl:e};if(t[4]){const e=t[4].slice(1).split(";");r.params={};for(const t of e){const e=t.split("=");r.params[e[0]]=e[1]}}return t[6]&&(r.path=t[6]),t[7]&&(r.query=t[7].slice(1)),t[8]&&(r.fragment=t[8].slice(1)),r}return null}(a);let d=null;const l=function(){if(c!==a){const r=f.find((e=>e.id===a));if(!r)throw new Error(`${Oi.INVALID_JWT}: No authenticator found for did URL ${a}`);return Promise.resolve(Di(e,{payload:n,header:o,signature:i,data:s},r,t)).then((function(e){d=e}))}{let r=0;return function(e,t,r){for(var n;;){var o=e();if(Hi(o)&&(o=o.v),!o)return i;if(o.then){n=0;break}var i=r();if(i&&i.then){if(!Hi(i)){n=1;break}i=i.s}if(t){var s=t();if(s&&s.then&&!Hi(s)){n=2;break}}}var c=new ji,a=Ci.bind(null,c,2);return(0===n?o.then(u):1===n?i.then(f):s.then(h)).then(void 0,a),c;function f(n){i=n;do{if(t&&(s=t())&&s.then&&!Hi(s))return void s.then(h).then(void 0,a);if(!(o=e())||Hi(o)&&!o.v)return void Ci(c,1,i);if(o.then)return void o.then(u).then(void 0,a);Hi(i=r())&&(i=i.v)}while(!i||!i.then);i.then(f).then(void 0,a)}function u(e){e?(i=r())&&i.then?i.then(f).then(void 0,a):f(i):Ci(c,1,i)}function h(){(o=e())?o.then?o.then(u).then(void 0,a):u(o):Ci(c,1,i)}}((function(){return!d&&r<f.length}),void 0,(function(){function c(e){r++}const a=f[r],u=function(r,c){try{var f=Promise.resolve(Di(e,{payload:n,header:o,signature:i,data:s},a,t)).then((function(e){d=e}))}catch(e){return c(e)}return f&&f.then?f.then(void 0,c):f}(0,(function(e){if(!e.message.includes(Oi.INVALID_SIGNATURE)||r===f.length-1)throw e}));return u&&u.then?u.then(c):c()}))}}();return l&&l.then?l.then(r):r()}if(!t.resolver)throw new Error("missing_resolver: No DID resolver has been configured");const{payload:n,header:o,signature:i,data:s}=ts(e,!1),c=Object.prototype.hasOwnProperty.call(t,"auth")?t.auth?"authentication":void 0:t.proofPurpose;let a,f,u,h;if(!n.iss&&!n.client_id)throw new Error(`${Oi.INVALID_JWT}: JWT iss or client_id are required`);if(t.didAuthenticator)a=t.didAuthenticator.issuer;else if(n.iss===Fi||n.iss===Mi){if(!n.sub)throw new Error(`${Oi.INVALID_JWT}: JWT sub is required`);a=void 0===n.sub_jwk?n.sub:(o.kid||"").split("#")[0]}else if(n.iss===Gi){if(!n.did)throw new Error(`${Oi.INVALID_JWT}: JWT did is required`);a=n.did}else if(!n.iss&&"openid"===n.scope&&n.redirect_uri){if(!n.client_id)throw new Error(`${Oi.INVALID_JWT}: JWT client_id is required`);a=n.client_id}else a=n.iss;if(!a)throw new Error(`${Oi.INVALID_JWT}: No DID has been found in the JWT`);const d=function(){if(!t.didAuthenticator)return Promise.resolve(Wi(t.resolver,o.alg,a,c)).then((function(e){({didResolutionResult:h,authenticators:f,issuer:u}=e),t.didAuthenticator={didResolutionResult:h,authenticators:f,issuer:u}}));({didResolutionResult:h,authenticators:f,issuer:u}=t.didAuthenticator)}();return Promise.resolve(d&&d.then?d.then(r):r())}catch(l){return Promise.reject(l)}},Ji=function(e,{expiresIn:t,canonicalize:r},n){try{if(0===n.length)throw new Error("invalid_argument: must provide one or more issuers");let f=e,u="";const h=(o=n,i=function(e){const o=n[e],i={typ:"JWT",alg:o.alg};return 0!==e&&(i.cty="JWT"),Promise.resolve(qi(f,{...o,canonicalize:r,expiresIn:t},i)).then((function(e){u=e,f={jwt:u}}))},a=-1,function e(t){try{for(;++a<o.length;)if((t=i(a))&&t.then){if(!Hi(t))return void t.then(e,c||(c=Ci.bind(null,s=new ji,2)));t=t.v}s?Ci(s,1,t):s=t}catch(e){Ci(s||(s=new ji),2,e)}}(),s);return Promise.resolve(h&&h.then?h.then((function(){return u})):u)}catch(e){return Promise.reject(e)}var o,i,s,c,a},qi=function(e,{issuer:t,signer:r,alg:n,expiresIn:o,canonicalize:i},s={}){try{if(!r)throw new Error("missing_signer: No Signer functionality has been configured");if(!t)throw new Error("missing_issuer: No issuing DID has been configured");s.typ||(s.typ="JWT"),s.alg||(s.alg=n);const c={iat:Math.floor(Date.now()/1e3),exp:void 0};if(o){if("number"!=typeof o)throw new Error("invalid_argument: JWT expiresIn is not a number");c.exp=(e.nbf||c.iat)+Math.floor(o)}const a={...c,...e,iss:t};return zi(a,r,s,{canonicalize:i})}catch(e){return Promise.reject(e)}},zi=function(e,t,r={},n={}){try{r.alg||(r.alg=Xi);const o="string"==typeof e?e:Yi(e,n.canonicalize),i=[Yi(r,n.canonicalize),o].join("."),s=function(e){const t=Si[e];if(!t)throw new Error(`not_supported: Unsupported algorithm ${e}`);return t}(r.alg);return Promise.resolve(s(i,t)).then((function(e){return[i,e].join(".")}))}catch(e){return Promise.reject(e)}},Fi="https://self-issued.me/v2",Mi="https://self-issued.me/v2/openid-vc",Gi="https://self-issued.me",Xi="ES256K",Zi="application/did+json";function Yi(e,t=!1){return Zo(t?Nn(e):JSON.stringify(e))}const Qi=300;function es(e){const t=e.match(/^([a-zA-Z0-9_-]+)\.([a-zA-Z0-9_-]+)\.([a-zA-Z0-9_-]+)$/);if(t)return{header:JSON.parse(Yo(t[1])),payload:t[2],signature:t[3],data:`${t[1]}.${t[2]}`};throw new Error("invalid_argument: Incorrect format JWS")}function ts(e,t=!0){if(!e)throw new Error("invalid_argument: no JWT passed into decodeJWT");try{const r=es(e),n=Object.assign(r,{payload:JSON.parse(Yo(r.payload))}),o=n.payload.iss;if("JWT"===n.header.cty&&t){const e=ts(n.payload.jwt);if(e.payload.iss!==o)throw new Error(`${Oi.INVALID_JWT}: multiple issuers`);return e}return n}catch(e){throw new Error("invalid_argument: Incorrect format JWT")}}function rs({header:e,payload:t,data:r,signature:n},o){Array.isArray(o)||(o=[o]);const i=t.iss;let s=!0;do{if(i!==t.iss)throw new Error(`${Oi.INVALID_JWT}: multiple issuers`);try{return Ti(e.alg)(r,n,o)}catch(e){if(!e.message.startsWith(Oi.INVALID_SIGNATURE))throw e}"JWT"!==e.cty?s=!1:({payload:t,header:e,signature:n,data:r}=ts(t.jwt,!1))}while(s);throw new Error(`${Oi.INVALID_SIGNATURE}: no matching public key found`)}function ns(e,t){return function({header:e,data:t,signature:r},n){return Array.isArray(n)||(n=[n]),Ti(e.alg)(t,r,n)}(es(e),t)}const os="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function is(e,t,r){if(!e.s){if(r instanceof ss){if(!r.s)return void(r.o=is.bind(null,e,t));1&t&&(t=r.s),r=r.v}if(r&&r.then)return void r.then(is.bind(null,e,t),is.bind(null,e,2));e.s=t,e.v=r;const n=e.o;n&&n(e)}}const ss=function(){function e(){}return e.prototype.then=function(t,r){const n=new e,o=this.s;if(o){const e=1&o?t:r;if(e){try{is(n,1,e(this.v))}catch(e){is(n,2,e)}return n}return this}return this.o=function(e){try{const o=e.v;1&e.s?is(n,1,t?t(o):o):r?is(n,1,r(o)):is(n,2,o)}catch(e){is(n,2,e)}},n},e}();function cs(e){return e instanceof ss&&1&e.s}function as({ciphertext:e,tag:t,iv:r,protectedHeader:n,recipient:o},i){const s={protected:n,iv:Co(r??new Uint8Array(0)),ciphertext:Co(e),tag:Co(t??new Uint8Array(0))};return i&&(s.aad=Co(i)),o&&(s.recipients=[o]),s}const fs=function(e,t){try{function r(e){if(null===s)throw new Error("failure: Failed to decrypt");return s}!function(e){if(!(e.protected&&e.iv&&e.ciphertext&&e.tag))throw new Error("bad_jwe: missing properties");e.recipients&&e.recipients.map((e=>{if(!e.header||!e.encrypted_key)throw new Error("bad_jwe: malformed recipients")}))}(e);const n=JSON.parse(Yo(e.protected));if(n.enc!==t.enc)throw new Error(`not_supported: Decrypter does not supported: '${n.enc}'`);const o=oi(e.ciphertext,e.tag),i=ti(e.aad?`${e.protected}.${e.aad}`:e.protected);let s=null;const c="dir"===n.alg&&"dir"===t.alg?Promise.resolve(t.decrypt(o,jo(e.iv),i)).then((function(e){s=e})):function(){if(e.recipients&&0!==e.recipients.length){let r=0;return function(e,t,r){for(var n;;){var o=e();if(cs(o)&&(o=o.v),!o)return i;if(o.then){n=0;break}var i=r();if(i&&i.then){if(!cs(i)){n=1;break}i=i.s}if(t){var s=t();if(s&&s.then&&!cs(s)){n=2;break}}}var c=new ss,a=is.bind(null,c,2);return(0===n?o.then(u):1===n?i.then(f):s.then(h)).then(void 0,a),c;function f(n){i=n;do{if(t&&(s=t())&&s.then&&!cs(s))return void s.then(h).then(void 0,a);if(!(o=e())||cs(o)&&!o.v)return void is(c,1,i);if(o.then)return void o.then(u).then(void 0,a);cs(i=r())&&(i=i.v)}while(!i||!i.then);i.then(f).then(void 0,a)}function u(e){e?(i=r())&&i.then?i.then(f).then(void 0,a):f(i):is(c,1,i)}function h(){(o=e())?o.then?o.then(u).then(void 0,a):u(o):is(c,1,i)}}((function(){return!s&&r<e.recipients.length}),(function(){return r++}),(function(){const c=e.recipients[r];Object.assign(c.header,n);const a=function(){if(c.header.alg===t.alg)return Promise.resolve(t.decrypt(o,jo(e.iv),i,c)).then((function(e){s=e}))}();if(a&&a.then)return a.then((function(){}))}))}throw new Error("bad_jwe: missing recipients")}();return Promise.resolve(c&&c.then?c.then(r):r())}catch(a){return Promise.reject(a)}},us=function(e,t,r={},n,o=!1){try{if("dir"===t[0].alg){if(t.length>1)throw new Error('not_supported: Can only do "dir" encryption to one key.');return Promise.resolve(t[0].encrypt(e,r,n)).then((function(e){return as(e,n)}))}{const i=t[0].enc;if(!t.reduce(((e,t)=>e&&t.enc===i),!0))throw new Error("invalid_argument: Incompatible encrypters passed");let s,c,a;if(o){a=t[0].genEpk?.();const e=t[0].alg;r={...r,alg:e,epk:a?.publicKeyJWK}}const f=function(e,t,r){if("function"==typeof e[os]){var n,o,i,s=e[os]();if(function e(c){try{for(;!((n=s.next()).done||r&&r());)if((c=t(n.value))&&c.then){if(!cs(c))return void c.then(e,i||(i=is.bind(null,o=new ss,2)));c=c.v}o?is(o,1,c):o=c}catch(e){is(o||(o=new ss),2,e)}}(),s.return){var c=function(e){try{n.done||s.return()}catch(e){}return e};if(o&&o.then)return o.then(c,(function(e){throw c(e)}));c()}return o}if(!("length"in e))throw new TypeError("Object is not iterable");for(var a=[],f=0;f<e.length;f++)a.push(e[f]);return function(e,t,r){var n,o,i=-1;return function s(c){try{for(;++i<e.length&&(!r||!r());)if((c=t(i))&&c.then){if(!cs(c))return void c.then(s,o||(o=is.bind(null,n=new ss,2)));c=c.v}n?is(n,1,c):n=c}catch(e){is(n||(n=new ss),2,e)}}(),n}(a,(function(e){return t(a[e])}),r)}(t,(function(t){const o=s?Promise.resolve(t.encryptCek?.(s,a)).then((function(e){e&&c?.recipients?.push(e)})):Promise.resolve(t.encrypt(e,r,n,a)).then((function(e){s=e.cek,c=as(e,n)}));if(o&&o.then)return o.then((function(){}))}));return Promise.resolve(f&&f.then?f.then((function(){return c})):c)}}catch(e){return Promise.reject(e)}};function hs(e){return(t,r)=>{const n=st(24),o=Do(e,n,r).encrypt(t);return{ciphertext:o.subarray(0,o.length-16),tag:o.subarray(o.length-16),iv:n}}}function ds(e){const t=hs(e),r="XC20P";return{alg:"dir",enc:r,encrypt:function(e,n={},o){try{const i=Zo(JSON.stringify(Object.assign({alg:"dir"},n,{enc:r}))),s=ti(o?`${i}.${Co(o)}`:i);return Promise.resolve({...t(e,s),protectedHeader:i})}catch(e){return Promise.reject(e)}}}}function ls(e){return{alg:"dir",enc:"XC20P",decrypt:function(t,r,n){try{try{return Promise.resolve(Do(e,r,n).decrypt(t))}catch(e){return Promise.resolve(null)}}catch(e){return Promise.reject(e)}}}}const ps=function(e,t,r,n,o,i){try{const t="X25519",n=256,s=i?ci(i.secretKey):si(),c={kty:"OKP",crv:t,x:Co(s.publicKey)},a=yi(Or.getSharedSecret(s.secretKey,e),n,r,void 0,jo(o??""));return Promise.resolve({epk:c,kek:a})}catch(e){return Promise.reject(e)}},ys=function(e,t,r){try{function n(){let t,n;return e.header.apu&&(t=jo(e.header.apu)),e.header.apv&&(n=jo(e.header.apv)),yi(a,i,r,t,n)}const o="X25519",i=256,s=e.header;if(s.epk?.crv!==o||void 0===s.epk.x)return Promise.resolve(null);const c=jo(s.epk.x);let a;const f=function(){if(!(t instanceof Uint8Array))return Promise.resolve(t(c)).then((function(e){a=e}));a=Or.getSharedSecret(t,c)}();return Promise.resolve(f&&f.then?f.then(n):n())}catch(u){return Promise.reject(u)}},gs=function(e,t,r,n,o,i){try{function s(){const e=new Uint8Array(h.length+d.length);e.set(h),e.set(d,h.length);let t=new Uint8Array(0),i=new Uint8Array(0);n&&(t=jo(n)),o&&(i=jo(o));const s=yi(e,a,r,t,i);return{epk:u,kek:s}}const c="X25519",a=256,f=i?ci(i.secretKey):si(),u={kty:"OKP",crv:c,x:Co(f.publicKey)},h=Or.getSharedSecret(f.secretKey,e);let d;const l=function(){if(!(t instanceof Uint8Array))return Promise.resolve(t(e)).then((function(e){d=e}));d=Or.getSharedSecret(t,e)}();return Promise.resolve(l&&l.then?l.then(s):s())}catch(p){return Promise.reject(p)}},ws=function(e,t,r,n){try{function o(){const t=new Uint8Array(f.length+u.length);let r,o;return t.set(f),t.set(u,f.length),e.header.apu&&(r=jo(e.header.apu)),e.header.apv&&(o=jo(e.header.apv)),yi(t,s,n,r,o)}const i="X25519",s=256,c=e.header;if(c.epk?.crv!==i||void 0===c.epk.x)return Promise.resolve(null);const a=jo(c.epk.x);let f,u;const h=function(){if(!(t instanceof Uint8Array))return Promise.resolve(t(a)).then((function(e){return f=e,Promise.resolve(t(r)).then((function(e){u=e}))}));f=Or.getSharedSecret(t,a),u=Or.getSharedSecret(t,r)}();return Promise.resolve(h&&h.then?h.then(o):o())}catch(d){return Promise.reject(d)}};function bs(e){if(32!==e.length)throw new Error("invalid_argument: incorrect secret key length for X25519");return function(t){try{if(32!==t.length)throw new Error("invalid_argument: incorrect publicKey key length for X25519");return Promise.resolve(Or.getSharedSecret(e,t))}catch(e){return Promise.reject(e)}}}function ms(e,t,r={},n,o,i){const s=function(i,s){try{return Promise.resolve(n.createKek(e,t,`${n.alg}+${o.alg}`,r.apu,r.apv,s)).then((function({epk:e,kek:t}){return Promise.resolve(o.from(t).wrap(i)).then((function(t){const i={encrypted_key:Co(t.ciphertext),header:{}};return t.iv&&(i.header.iv=Co(t.iv)),t.tag&&(i.header.tag=Co(t.tag)),r.kid&&(i.header.kid=r.kid),r.apu&&(i.header.apu=r.apu),r.apv&&(i.header.apv=r.apv),s||(i.header.alg=`${n.alg}+${o.alg}`,i.header.epk=e),i}))}))}catch(e){return Promise.reject(e)}};return{alg:o.alg,enc:i.enc,encrypt:function(e,t={},r,c){try{Object.assign(t,{alg:void 0});const a=st(32);return Promise.resolve(s(a,c)).then((function(s){return c&&(t.alg=`${n.alg}+${o.alg}`,t.epk=c.publicKeyJWK),Promise.resolve(i.from(a).encrypt(e,t,r)).then((function(e){return{...e,recipient:s,cek:a}}))}))}catch(e){return Promise.reject(e)}},encryptCek:s,genEpk:ai}}const Es=function(e,t){try{const r=function(e,n=[]){try{return Promise.resolve(t.resolve(e)).then((function({didResolutionMetadata:t,didDocument:o}){function i(){const t=o.keyAgreement?.map((e=>"string"==typeof e?[...o.publicKey||[],...o.verificationMethod||[]].find((t=>t.id===e)):e))?.filter((e=>void 0!==e)),r=t?.filter((e=>["X25519KeyAgreementKey2019","X25519KeyAgreementKey2020","JsonWebKey2020","Multikey"].includes(e.type)))??[];if(!r.length&&!s.length)throw new Error(`no_suitable_keys: Could not find X25519 key for ${e}`);return r.map((e=>{const{keyBytes:t,keyType:r}=Fo(e);return"X25519"===r?ks(t,e.id):null})).filter(fi).concat(...s)}if(n.push(e),t?.error||null==o)throw new Error(`resolver_error: Could not resolve ${e}: ${t.error}, ${t.message}`);let s=[];if(!o.controller&&!o.keyAgreement)throw new Error(`no_suitable_keys: Could not find x25519 key for ${e}`);const c=function(){if(o.controller){let e=Array.isArray(o.controller)?o.controller:[o.controller];e=e.filter((e=>!n.includes(e)));const t=e.map((e=>r(e,n).catch((()=>[]))));return Promise.resolve(Promise.all(t)).then((function(e){s=[].concat(...e)}))}}();return c&&c.then?c.then(i):i()}))}catch(e){return Promise.reject(e)}},n=e.map((e=>r(e)));return Promise.resolve(Promise.all(n)).then((function(e){return[].concat(...e)}))}catch(e){return Promise.reject(e)}};function vs(e,t,r={}){return Us(e,t,r)}function xs(e,t={}){return Ps(e,t)}function As(e,t){return Ls(e,t)}function Bs(e){return Os(e)}function Ss(e){if(!(e&&e.epk&&e.iv&&e.tag))throw new Error("bad_jwe: malformed header");return e}const Is={from:e=>({wrap:function(t){try{return Promise.resolve(hs(e)(t))}catch(e){return Promise.reject(e)}}}),alg:"XC20PKW"};function ks(e,t,r){return Ps(e,{kid:t,apv:r})}function Ps(e,t={}){return ms(e,void 0,t,{createKek:ps,alg:"ECDH-ES"},Is,{from:e=>ds(e),enc:"XC20P"})}function Us(e,t,r={}){return ms(e,t,r,{createKek:gs,alg:"ECDH-1PU"},Is,{from:e=>ds(e),enc:"XC20P"})}function Ts(e){return Os(e)}function Os(e){const t="ECDH-ES+XC20PKW";return{alg:t,enc:"XC20P",decrypt:function(r,n,o,i){try{const s=Ss(i.header);return Promise.resolve(ys(i,e,t)).then((function(e){if(!e)return null;const t=oi(i.encrypted_key,s.tag);return Promise.resolve(ls(e).decrypt(t,jo(s.iv))).then((function(e){return null===e?null:ls(e).decrypt(r,n,o)}))}))}catch(e){return Promise.reject(e)}}}}function Ls(e,t){const r="ECDH-1PU+XC20PKW";return{alg:r,enc:"XC20P",decrypt:function(n,o,i,s){try{const c=Ss(s.header);return Promise.resolve(ws(s,e,t,r)).then((function(e){if(!e)return null;const t=oi(s.encrypted_key,c.tag);return Promise.resolve(ls(e).decrypt(t,jo(c.iv))).then((function(e){return null===e?null:ls(e).decrypt(n,o,i)}))}))}catch(e){return Promise.reject(e)}}}}})();var o=n._D,i=n.qT,s=n.vo,c=n._J,a=n.Fh,f=n.Qu,u=n.R8,h=n.Ks,d=n.K9,l=n.NX,p=n.RV,y=n.ci,g=n.z0,w=n.kr,b=n.Gp,m=n.Qf,E=n._6,v=n.ax,x=n.P9,A=n.aD,B=n.I7,S=n.zO,I=n.pk,k=n.XX,P=n.qK,U=n.yv,T=n.xK,O=n.fq,L=n.xp,R=n.jB,$=n.cJ,K=n.bK,N=n.nr,D=n._v,_=n.AX,C=n.Md,j=n.Mq,H=n.ZW,W=n.PZ,V=n.Y,J=n.Qv,q=n.$1,z=n._I,F=n.UR,M=n.C2;export{o as ES256KSigner,i as ES256Signer,s as EdDSASigner,c as EllipticSigner,a as JWT_ERROR,f as NaclSigner,u as SimpleSigner,h as base58ToBytes,d as base64ToBytes,l as bytesToBase58,p as bytesToBase64url,y as bytesToHex,g as bytesToMultibase,w as computeX25519Ecdh1PUv3Kek,b as computeX25519EcdhEsKek,m as concatKDF,E as createAnonDecrypter,v as createAnonEncrypter,x as createAuthDecrypter,A as createAuthEncrypter,B as createFullEncrypter,S as createJWE,I as createJWS,k as createJWT,P as createMultisignatureJWT,U as createX25519ECDH,T as createX25519Ecdh1PUv3Kek,O as createX25519EcdhEsKek,L as decodeJWT,R as decryptJWE,$ as extractPublicKeyBytes,K as genX25519EphemeralKeyPair,N as hexToBytes,D as multibaseToBytes,_ as resolveX25519Encrypters,C as supportedCodecs,j as toEthereumAddress,H as verifyJWS,W as verifyJWT,V as x25519Decrypter,J as x25519Encrypter,q as xc20pAuthDecrypterEcdh1PuV3x25519WithXc20PkwV2,z as xc20pAuthEncrypterEcdh1PuV3x25519WithXc20PkwV2,F as xc20pDirDecrypter,M as xc20pDirEncrypter};